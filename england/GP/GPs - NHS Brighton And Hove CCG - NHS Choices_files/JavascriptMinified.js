(function(a){a.extend(a.fn,{validate:function(c){if(!this.length){c&&c.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var d=a.data(this[0],"validator");if(d){return d}this.attr("novalidate","novalidate");d=new a.validator(c,this[0]);a.data(this[0],"validator",d);if(d.settings.onsubmit){var b=this.find("input, button");b.filter(".cancel").click(function(){d.cancelSubmit=true});if(d.settings.submitHandler){b.filter(":submit").click(function(){d.submitButton=this})}this.submit(function(f){if(d.settings.debug){f.preventDefault()}function e(){if(d.settings.submitHandler){if(d.submitButton){var g=a("<input type='hidden'/>").attr("name",d.submitButton.name).val(d.submitButton.value).appendTo(d.currentForm)}d.settings.submitHandler.call(d,d.currentForm);if(d.submitButton){g.remove()}return false}return true}if(d.cancelSubmit){d.cancelSubmit=false;return e()}if(d.form()){if(d.pendingRequest){d.formSubmitted=true;return false}return e()}else{d.focusInvalid();return false}})}return d},valid:function(){if(a(this[0]).is("form")){return this.validate().form()}else{var c=true;var b=a(this[0].form).validate();this.each(function(){c&=b.element(this)});return c}},removeAttrs:function(c){var b={},d=this;a.each(c.split(/\s/),function(e,f){b[f]=d.attr(f);d.removeAttr(f)});return b},rules:function(i,g){var c=this[0];if(i){var b=a.data(c.form,"validator").settings;var d=b.rules;var e=a.validator.staticRules(c);switch(i){case"add":a.extend(e,a.validator.normalizeRule(g));d[c.name]=e;if(g.messages){b.messages[c.name]=a.extend(b.messages[c.name],g.messages)}break;case"remove":if(!g){delete d[c.name];return e}var h={};a.each(g.split(/\s/),function(l,k){h[k]=e[k];delete e[k]});return h}}var f=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(c),a.validator.classRules(c),a.validator.attributeRules(c),a.validator.staticRules(c)),c);if(f.required){var j=f.required;delete f.required;f=a.extend({required:j},f)}return f}});a.extend(a.expr[":"],{blank:function(b){return !a.trim(""+b.value)},filled:function(b){return !!a.trim(""+b.value)},unchecked:function(b){return !b.checked}});a.validator=function(c,b){this.settings=a.extend(true,{},a.validator.defaults,c);this.currentForm=b;this.init()};a.validator.format=function(b,c){if(arguments.length==1){return function(){var d=a.makeArray(arguments);d.unshift(b);return a.validator.format.apply(this,d)}}if(arguments.length>2&&c.constructor!=Array){c=a.makeArray(arguments).slice(1)}if(c.constructor!=Array){c=[c]}a.each(c,function(e,d){b=b.replace(new RegExp("\\{"+e+"\\}","g"),d)});return b};a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(b,c){this.lastActive=b;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,b,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(b)).hide()}},onfocusout:function(b,c){if(!this.checkable(b)&&(b.name in this.submitted||!this.optional(b))){this.element(b)}},onkeyup:function(b,c){if(b.name in this.submitted||b==this.lastElement){this.element(b)}},onclick:function(b,c){if(b.name in this.submitted){this.element(b)}else{if(b.parentNode.name in this.submitted){this.element(b.parentNode)}}},highlight:function(d,c,b){if(d.type==="radio"){this.findByName(d.name).addClass(c).removeClass(b)}else{a(d).addClass(c).removeClass(b)}},unhighlight:function(d,c,b){if(d.type==="radio"){this.findByName(d.name).removeClass(c).addClass(b)}else{a(d).removeClass(c).addClass(b)}}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=a(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm);this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var d=(this.groups={});a.each(this.settings.groups,function(e,f){a.each(f.split(/\s/),function(g,h){d[h]=e})});var b=this.settings.rules;a.each(b,function(e,f){b[e]=a.validator.normalizeRule(f)});function c(f){var g=a.data(this[0].form,"validator"),e="on"+f.type.replace(/^validate/,"");g.settings[e]&&g.settings[e].call(g,this[0],f)}a(this.currentForm).validateDelegate("[type='text'], [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",c).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",c);if(this.settings.invalidHandler){a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();a.extend(this.submitted,this.errorMap);this.invalid=a.extend({},this.errorMap);if(!this.valid()){a(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var c=0,b=(this.currentElements=this.elements());b[c];c++){this.check(b[c])}return this.valid()},element:function(b){b=this.validationTargetFor(this.clean(b));this.lastElement=b;this.prepareElement(b);this.currentElements=a(b);var c=this.check(b);if(c){delete this.invalid[b.name]}else{this.invalid[b.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return c},showErrors:function(b){if(b){a.extend(this.errorMap,b);this.errorList=[];for(var c in b){this.errorList.push({message:b[c],element:this.findByName(c)[0]})}this.successList=a.grep(this.successList,function(d){return !(d.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if(a.fn.resetForm){a(this.currentForm).resetForm()}this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(d){var b=0;for(var c in d){b++}return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}}},findLastActive:function(){var b=this.lastActive;return b&&a.grep(this.errorList,function(c){return c.element.name==b.name}).length==1&&b},elements:function(){var c=this,b={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&c.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!c.objectLength(a(this).rules())){return false}b[this.name]=true;return true})},clean:function(b){return a(b)[0]},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=a([]);this.toHide=a([]);this.currentElements=a([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(b){this.reset();this.toHide=this.errorsFor(b)},check:function(c){c=this.validationTargetFor(this.clean(c));var h=a(c).rules();var b=false;for(var i in h){var g={method:i,parameters:h[i]};try{var f=a.validator.methods[i].call(this,c.value.replace(/\r/g,""),c,g.parameters);if(f=="dependency-mismatch"){b=true;continue}b=false;if(f=="pending"){this.toHide=this.toHide.not(this.errorsFor(c));return}if(!f){this.formatAndAdd(c,g);return false}}catch(d){this.settings.debug&&window.console&&console.log("exception occured when checking element "+c.id+", check the '"+g.method+"' method",d);throw d}}if(b){return}if(this.objectLength(h)){this.successList.push(c)}return true},customMetaMessage:function(d,c){if(!a.metadata){return}var b=this.settings.meta?a(d).metadata()[this.settings.meta]:a(d).metadata();return b&&b.messages&&b.messages[c]},customMessage:function(d,b){var c=this.settings.messages[d];return c&&(c.constructor==String?c:c[b])},findDefined:function(){for(var b=0;b<arguments.length;b++){if(arguments[b]!==undefined){return arguments[b]}}return undefined},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customMetaMessage(b,c),!this.settings.ignoreTitle&&b.title||undefined,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(d,c){var b=this.defaultMessage(d,c.method),e=/\$?\{(\d+)\}/g;if(typeof b=="function"){b=b.call(this,c.parameters,d)}else{if(e.test(b)){b=jQuery.format(b.replace(e,"{$1}"),c.parameters)}}this.errorList.push({message:b,element:d});this.errorMap[d.name]=b;this.submitted[d.name]=b},addWrapper:function(b){if(this.settings.wrapper){b=b.add(b.parent(this.settings.wrapper))}return b},defaultShowErrors:function(){for(var c=0;this.errorList[c];c++){var b=this.errorList[c];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var c=0;this.successList[c];c++){this.showLabel(this.successList[c])}}if(this.settings.unhighlight){for(var c=0,d=this.validElements();d[c];c++){this.settings.unhighlight.call(this,d[c],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(d,c){var b=this.errorsFor(d);if(b.length){b.removeClass(this.settings.validClass).addClass(this.settings.errorClass);b.attr("generated")&&b.html(c)}else{b=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(d),generated:true}).addClass(this.settings.errorClass).html(c||"");if(this.settings.wrapper){b=b.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(b).length){this.settings.errorPlacement?this.settings.errorPlacement(b,a(d)):b.insertAfter(d)}}if(!c&&this.settings.success){b.text("");typeof this.settings.success=="string"?b.addClass(this.settings.success):this.settings.success(b)}this.toShow=this.toShow.add(b)},errorsFor:function(b){var c=this.idOrName(b);return this.errors().filter(function(){return a(this).attr("for")==c})},idOrName:function(b){return this.groups[b.name]||(this.checkable(b)?b.name:b.id||b.name)},validationTargetFor:function(b){if(this.checkable(b)){b=this.findByName(b.name).not(this.settings.ignore)[0]}return b},checkable:function(b){return/radio|checkbox/i.test(b.type)},findByName:function(c){var b=this.currentForm;return a(document.getElementsByName(c)).map(function(e,d){return d.form==b&&d.name==c&&d||null})},getLength:function(c,b){switch(b.nodeName.toLowerCase()){case"select":return a("option:selected",b).length;case"input":if(this.checkable(b)){return this.findByName(b.name).filter(":checked").length}}return c.length},depend:function(c,b){return this.dependTypes[typeof c]?this.dependTypes[typeof c](c,b):true},dependTypes:{"boolean":function(c,b){return c},string:function(c,b){return !!a(c,b.form).length},"function":function(c,b){return c(b)}},optional:function(b){return !a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch"},startRequest:function(b){if(!this.pending[b.name]){this.pendingRequest++;this.pending[b.name]=true}},stopRequest:function(b,c){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[b.name];if(c&&this.pendingRequest==0&&this.formSubmitted&&this.form()){a(this.currentForm).submit();this.formSubmitted=false}else{if(!c&&this.pendingRequest==0&&this.formSubmitted){a(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}}},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:true,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(b,c){b.constructor==String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(d){var b={};var c=a(d).attr("class");c&&a.each(c.split(" "),function(){if(this in a.validator.classRuleSettings){a.extend(b,a.validator.classRuleSettings[this])}});return b},attributeRules:function(e){var b={};var f=a(e);for(var c in a.validator.methods){var d;if(c==="required"&&typeof a.fn.prop==="function"){d=f.prop(c)}else{d=f.attr(c)}if(d){b[c]=d}else{if(f[0].getAttribute("type")===c){b[c]=true}}}if(b.maxlength&&/-1|2147483647|524288/.test(b.maxlength)){delete b.maxlength}return b},metadataRules:function(b){if(!a.metadata){return{}}var c=a.data(b.form,"validator").settings.meta;return c?a(b).metadata()[c]:a(b).metadata()},staticRules:function(c){var b={};var d=a.data(c.form,"validator");if(d.settings.rules){b=a.validator.normalizeRule(d.settings.rules[c.name])||{}}return b},normalizeRules:function(c,b){a.each(c,function(e,f){if(f===false){delete c[e];return}if(f.param||f.depends){var d=true;switch(typeof f.depends){case"string":d=!!a(f.depends,b.form).length;break;case"function":d=f.depends.call(b,b);break}if(d){c[e]=f.param!==undefined?f.param:true}else{delete c[e]}}});a.each(c,function(d,e){c[d]=a.isFunction(e)?e(b):e});a.each(["minlength","maxlength","min","max"],function(){if(c[this]){c[this]=Number(c[this])}});a.each(["rangelength","range"],function(){if(c[this]){c[this]=[Number(c[this][0]),Number(c[this][1])]}});if(a.validator.autoCreateRanges){if(c.min&&c.max){c.range=[c.min,c.max];delete c.min;delete c.max}if(c.minlength&&c.maxlength){c.rangelength=[c.minlength,c.maxlength];delete c.minlength;delete c.maxlength}}if(c.messages){delete c.messages}return c},normalizeRule:function(b){if(typeof b=="string"){var c={};a.each(b.split(/\s/),function(){c[this]=true});b=c}return b},addMethod:function(d,c,b){a.validator.methods[d]=c;a.validator.messages[d]=b!=undefined?b:a.validator.messages[d];if(c.length<3){a.validator.addClassRules(d,a.validator.normalizeRule(d))}},methods:{required:function(b,d,e){if(!this.depend(e,d)){return"dependency-mismatch"}switch(d.nodeName.toLowerCase()){case"select":var c=a(d).val();return c&&c.length>0;case"input":if(this.checkable(d)){return this.getLength(b,d)>0}default:return a.trim(b).length>0}},remote:function(b,c,g){if(this.optional(c)){return"dependency-mismatch"}var e=this.previousValue(c);if(!this.settings.messages[c.name]){this.settings.messages[c.name]={}}e.originalMessage=this.settings.messages[c.name].remote;this.settings.messages[c.name].remote=e.message;g=typeof g=="string"&&{url:g}||g;if(this.pending[c.name]){return"pending"}if(e.old===b){return e.valid}e.old=b;var d=this;this.startRequest(c);var f={};f[c.name]=b;a.ajax(a.extend(true,{url:g,mode:"abort",port:"validate"+c.name,dataType:"json",data:f,success:function(k){d.settings.messages[c.name].remote=e.originalMessage;var j=k===true;if(j){var l=d.formSubmitted;d.prepareElement(c);d.formSubmitted=l;d.successList.push(c);d.showErrors()}else{var h={};var i=k||d.defaultMessage(c,"remote");h[c.name]=e.message=a.isFunction(i)?i(b):i;d.showErrors(h)}e.valid=j;d.stopRequest(c,j)}},g));return"pending"},minlength:function(b,c,d){return this.optional(c)||this.getLength(a.trim(b),c)>=d},maxlength:function(b,c,d){return this.optional(c)||this.getLength(a.trim(b),c)<=d},rangelength:function(b,d,e){var c=this.getLength(a.trim(b),d);return this.optional(d)||(c>=e[0]&&c<=e[1])},min:function(b,c,d){return this.optional(c)||b>=d},max:function(b,c,d){return this.optional(c)||b<=d},range:function(b,c,d){return this.optional(c)||(b>=d[0]&&b<=d[1])},email:function(c,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(c)},url:function(c,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c)},date:function(c,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(c))},dateISO:function(c,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(c)},number:function(c,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(c)},digits:function(c,b){return this.optional(b)||/^\d+$/.test(c)},creditcard:function(b,c){if(this.optional(c)){return"dependency-mismatch"}if(/[^0-9 -]+/.test(b)){return false}var g=0,d=0,f=false;b=b.replace(/\D/g,"");for(var e=b.length-1;e>=0;e--){var h=b.charAt(e);var d=parseInt(h,10);if(f){if((d*=2)>9){d-=9}}g+=d;f=!f}return(g%10)==0},accept:function(b,c,d){d=typeof d=="string"?d.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(c)||b.match(new RegExp(".("+d+")$","i"))},equalTo:function(b,d,e){var c=a(e).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(d).valid()});return b==c.val()}}});a.format=a.validator.format})(jQuery);(function(c){var a={};if(c.ajaxPrefilter){c.ajaxPrefilter(function(g,e,d){var f=g.port;if(g.mode=="abort"){if(a[f]){a[f].abort()}a[f]=d}})}else{var b=c.ajax;c.ajax=function(f){var e=("mode" in f?f:c.ajaxSettings).mode,d=("port" in f?f:c.ajaxSettings).port;if(e=="abort"){if(a[d]){a[d].abort()}return(a[d]=b.apply(this,arguments))}return b.apply(this,arguments)}}})(jQuery);(function(a){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){a.each({focus:"focusin",blur:"focusout"},function(c,d){a.event.special[d]={setup:function(){this.addEventListener(c,b,true)},teardown:function(){this.removeEventListener(c,b,true)},handler:function(f){arguments[0]=a.event.fix(f);arguments[0].type=d;return a.event.handle.apply(this,arguments)}};function b(f){f=a.event.fix(f);f.type=d;return a.event.handle.call(this,f)}})}a.extend(a.fn,{validateDelegate:function(c,d,b){return this.bind(d,function(e){var f=a(e.target);if(f.is(c)){return b.apply(f,arguments)}})}})})(jQuery);(function(){JSLINQ=window.JSLINQ=function(a){return new JSLINQ.fn.init(a)};JSLINQ.fn=JSLINQ.prototype={init:function(a){this.items=a},jslinq:"2.10",ToArray:function(){return this.items},Where:function(a){var c;var d=new Array();for(var b=0;b<this.items.length;b++){if(a(this.items[b],b)){d[d.length]=this.items[b]}}return new JSLINQ(d)},Select:function(a){var c;var d=new Array();for(var b=0;b<this.items.length;b++){if(a(this.items[b])){d[d.length]=a(this.items[b])}}return new JSLINQ(d)},OrderBy:function(c){var a=new Array();for(var b=0;b<this.items.length;b++){a[a.length]=this.items[b]}return new JSLINQ(a.sort(function(d,e){var f=c(d);var g=c(e);return((f<g)?-1:((f>g)?1:0))}))},OrderByDescending:function(c){var a=new Array();for(var b=0;b<this.items.length;b++){a[a.length]=this.items[b]}return new JSLINQ(a.sort(function(d,e){var f=c(e);var g=c(d);return((f<g)?-1:((f>g)?1:0))}))},SelectMany:function(c){var a=new Array();for(var b=0;b<this.items.length;b++){a=a.concat(c(this.items[b]))}return new JSLINQ(a)},Count:function(a){if(a==null){return this.items.length}else{return this.Where(a).items.length}},Distinct:function(a){var d;var b=new Object();var e=new Array();for(var c=0;c<this.items.length;c++){d=a(this.items[c]);if(b[d]==null){b[d]=true;e[e.length]=d}}b=null;return new JSLINQ(e)},Any:function(a){for(var b=0;b<this.items.length;b++){if(a(this.items[b],b)){return true}}return false},All:function(a){for(var b=0;b<this.items.length;b++){if(!a(this.items[b],b)){return false}}return true},Reverse:function(){var b=new Array();for(var a=this.items.length-1;a>-1;a--){b[b.length]=this.items[a]}return new JSLINQ(b)},First:function(a){if(a!=null){return this.Where(a).First()}else{if(this.items.length>0){return this.items[0]}else{return null}}},Last:function(a){if(a!=null){return this.Where(a).Last()}else{if(this.items.length>0){return this.items[this.items.length-1]}else{return null}}},ElementAt:function(a){return this.items[a]},Concat:function(b){var a=b.items||b;return new JSLINQ(this.items.concat(a))},Intersect:function(e,c){var d;if(c!=undefined){d=c}else{d=function(k,j,a,b){return k==a}}var i=e.items||e;var h=new Array();for(var f=0;f<this.items.length;f++){for(var g=0;g<i.length;g++){if(d(this.items[f],f,i[g],g)){h[h.length]=this.items[f]}}}return new JSLINQ(h)},DefaultIfEmpty:function(a){if(this.items.length==0){return a}return this},ElementAtOrDefault:function(b,a){if(b>=0&&b<this.items.length){return this.items[b]}return a},FirstOrDefault:function(a){return this.First()||a},LastOrDefault:function(a){return this.Last()||a}};JSLINQ.fn.init.prototype=JSLINQ.fn})();(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length){settings.single="metadata"}var data=$.data(elem,settings.single);if(data){return data}data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m){data=m[1]}}else{if(settings.type=="elem"){if(!elem.getElementsByTagName){return undefined}var e=elem.getElementsByTagName(settings.name);if(e.length){data=$.trim(e[0].innerHTML)}}else{if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr){data=attr}}}}if(data.indexOf("{")<0){data="{"+data+"}"}data=eval("("+data+")");$.data(elem,settings.single,data);return data}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts)}})(jQuery);(function(c){c.tinysort={id:"TinySort",version:"1.0.2",defaults:{order:"asc",attr:"",place:"start",returns:false}};c.fn.extend({tinysort:function(k,d){if(k&&typeof(k)!="string"){d=k;k=null}var g=c.extend({},c.tinysort.defaults,d);var q={};this.each(function(s){var t=(!k||k=="")?c(this):c(this).find(k);var u=g.order=="rand"?""+Math.random():(g.attr==""?t.text():t.attr(g.attr));var v=c(this).parent();if(!q[v]){q[v]={s:[],n:[]}}if(t.length>0){q[v].s.push({s:u,e:c(this),n:s})}else{q[v].n.push({e:c(this),n:s})}});for(var l in q){var r=q[l];r.s.sort(function h(i,s){var t=i.s.toLowerCase?i.s.toLowerCase():i.s;var u=s.s.toLowerCase?s.s.toLowerCase():s.s;if(a(i.s)&&a(s.s)){t=parseFloat(i.s);u=parseFloat(s.s)}return(g.order=="asc"?1:-1)*(t<u?-1:(t>u?1:0))})}var o=[];for(var l in q){var r=q[l];var e=[];var p=c(this).length;switch(g.place){case"first":c.each(r.s,function(s,t){p=Math.min(p,t.n)});break;case"org":c.each(r.s,function(s,t){e.push(t.n)});break;case"end":p=r.n.length;break;default:p=0}var n=[0,0];for(var j=0;j<c(this).length;j++){var f=j>=p&&j<p+r.s.length;if(b(e,j)){f=true}var m=(f?r.s:r.n)[n[f?0:1]].e;m.parent().append(m);if(f||!g.returns){o.push(m.get(0))}n[f?0:1]++}}return this.setArray(o)}});function a(d){return/^[\+-]?\d*\.?\d*$/.exec(d)}function b(e,f){var d=false;c.each(e,function(g,h){if(!d){d=h==f}});return d}c.fn.TinySort=c.fn.Tinysort=c.fn.tsort=c.fn.tinysort})(jQuery);jQuery.format=function(b,c){var a=b;for(i=0;i<c.length;i++){a=a.replace("{"+i+"}",c[i])}return a};jQuery.fn.extend({fadeDisable:function(){$(this).animate({opacity:0.3},500);$(this).find("a").addClass("disabled");return $(this)},fadeEnable:function(){$(this).animate({opacity:1},500);$(this).find("a").removeClass("disabled");return $(this)}});function validateForm(){var a=$("#aspnetForm").validate({errorClass:"none",validClass:"",ignore:".ignore",errorElement:"p",errorPlacement:function(b,d){if(b.text().length>0){if(d.attr("id")=="indicator-val"){d.next("p").after(b)}else{b.insertAfter(d)}var c=$("<div class='panel-assistance-mesg panel-error clear' />");$(b).wrap(c)}},highlight:function(d,c,b){},unhighlight:function(d,c,b){$(d).parent().find("div.panel-error").remove()}});return $("#aspnetForm").valid()}jQuery.validator.addMethod("URLStart",function(b,a){return this.optional(a)||/^https?:\/\/.?/.test(b)});jQuery.validator.addClassRules("URLStart",{URLStart:true});jQuery.validator.messages.URLStart="Please enter a valid http URL.";jQuery.validator.addMethod("phone",function(b,a){return this.optional(a)||/^[\d ]{10,13}$/.test(b)});jQuery.validator.addClassRules("phone",{phone:true});jQuery.validator.messages.phone="Please enter a valid UK phone number.";jQuery.validator.addMethod("phoneChargeAmount",function(a,b){var c=$(".phone").val();if(!/^084|^087|^09|^118/.test(c)){return true}if(a==""||a==0){return false}if(a.length>3){return false}return this.optional(b)||(/^[1-9][\d]{0,2}$/.test(a)&&/^084|^087|^09|^118/.test(c))});jQuery.validator.addClassRules("phoneChargeAmount",{phoneChargeAmount:true});jQuery.validator.messages.phoneChargeAmount="Please enter cost of the call from 1-999 pence.";jQuery.validator.addMethod("word",function(b,a){return this.optional(a)||/^[A-Za-z0-9\s]+$/.test(b)});jQuery.validator.addClassRules("word",{word:true});jQuery.validator.messages.word="Please enter a valid word.";jQuery.validator.addMethod("dropdown",function(b,a){return b!="Select one"});jQuery.validator.addClassRules("dropdown",{dropdown:true});jQuery.validator.messages.dropdown="Please enter valid value.";jQuery.validator.addMethod("number",function(b,a){return this.optional(a)||/^[\d]+$/.test(b)});jQuery.validator.addClassRules("number",{number:true});jQuery.validator.addMethod("percentage",function(b,a){return this.optional(a)||(b<=100&&/^[1-9]?\d\.?\d?$/.test(b))});jQuery.validator.addClassRules("percentage",{percentage:true});jQuery.validator.messages.percentage="Please enter a valid percentage between and 0 and 100 with no more than 1 decimal place.";jQuery.validator.addMethod("postcode",function(b,a){return this.optional(a)||/^([A-PR-UWYZ0-9][A-HIK-Y0-9][ACDEFGHKMNPRTUVXY0-9]?[ABEHMNPRVWXY0-9]?[ ]{1,2}[0-9][ABD-HJLN-UW-Z]{2})$$/.test(b.toUpperCase())});jQuery.validator.addClassRules("postcode",{postcode:true});jQuery.validator.messages.postcode="Please enter a valid UK postcode using capital letters where appropriate.";jQuery.validator.addMethod("tinymce",function(b,a){return validateMCE(true)});jQuery.validator.addClassRules("tinymce",{tinymce:true});jQuery.validator.messages.tinymce="";jQuery.validator.addMethod("forceautocomplete",function(b,a){return jQuery.inArray(b.toUpperCase(),$(a).data("autocompletedata"))>-1});jQuery.validator.addClassRules("forceautocomplete",{forceautocomplete:true});jQuery.validator.addMethod("selectradio",function(b,a){return $(a).parents(".radios-parent").find('input[type="radio"]').is(":checked")});jQuery.validator.addClassRules({selectradio:{selectradio:true}});jQuery.validator.addMethod("ddmmyyyyDateWithMinimumYear",ValidateddmmyyyyDateWithMinimumYear,jQuery.validator.format("Please enter a valid date, no earlier than {0} years ago, in dd/mm/yyyy format"));jQuery.validator.addMethod("ddmmyyyyDate",ValidateddmmyyyyDate,"Please enter a valid date in dd/mm/yyyy format");var ddmmyyyyDateHintText="dd/mm/yyyy";function ValidateddmmyyyyDateWithMinimumYear(a,d,c){if(this.optional(d)){return true}if(a==ddmmyyyyDateHintText){return true}if(!DoesStringRepresentAValidddmmyyyyDate(a)){return false}var e=GetYearFromAddmmyyyyDateString(a);var b=new Date().getFullYear()-c[0];if(e<b){return false}return true}function ValidateddmmyyyyDate(a,c,b){if(this.optional(c)){return true}if(a==ddmmyyyyDateHintText){return true}return DoesStringRepresentAValidddmmyyyyDate(a)}function GetYearFromAddmmyyyyDateString(a){var b=MatchStringToddmmyyyyFormat(a);if(b==null){return}return b[5]}function DoesStringRepresentAValidddmmyyyyDate(e){var d=MatchStringToddmmyyyyFormat(e);if(d==null){return false}var a=d[1];var b=d[3];var c=d[5];if(b>12){return false}if(b=="04"||b=="06"||b=="09"||b=="11"){if(a>30){return false}}if(b=="01"||b=="03"||b=="05"||b=="07"||b=="08"||b=="10"||b=="12"){if(a>31){return false}}if(b=="02"){if(!DayValidInFeburary(a,c)){return false}}return true}function MatchStringToddmmyyyyFormat(a){return a.match(/^(\d\d?)(\/)(\d\d?)(\/)(\d{4})$/)}function DayValidInFeburary(a,b){var c=new Date(b,1,29).getDate()==29;if(c){return a<=29}return a<=28}jQuery.validator.addMethod("morethan",ValidateMoreThan,"The From value must be less than the To value. Ensure you have entered the price correctly and try again.");jQuery.validator.addClassRules("morethan",{morethan:true});function ValidateMoreThan(a,b,c){if(this.optional(b)){return true}var e=b.id.indexOf("_"+b.name);var d=b.id.substring(0,e);var f=$("#"+d+"_txtMinCost").val();if(parseInt(f,10)<parseInt(a,10)){return true}return false}jQuery.validator.addMethod("dependentonothers",ValidateDependentOnOthers,"If one value is entered both must be valid");jQuery.validator.addClassRules("dependentonothers",{dependentonothers:true});function ValidateDependentOnOthers(a,b,c){if(this.optional(b)){return true}var f=b.id.indexOf("_"+b.name);var d=b.id.substring(0,f);var g=$("#"+d+"_txtMinCost").val();var e=$("#"+d+"_txtMaxCost").val();if(/^[\d]+$/.test(g)&&/^[\d]+$/.test(e)){return true}return false}jQuery.fn.maxLength=function(){this.each(function(){if(this.tagName.toLowerCase()!="textarea"){return}var d=$("#"+this.id);var c=parseInt(d.attr("maxlength"),10);if(!c){return}d.bind("keydown",function(f){if((!f.altKey&&!f.ctrlKey)&&(f.keyCode==32||f.keyCode==13||f.keyCode>47)){return b(f)}});d.bind("drop",function(f){return b(f)});var a=false;d.bind("paste",function(f){a=true});d.bind("mouseup keyup",function(f){if(a){a=false;b(f)}});function b(g){var f=d.val();if(c&&(f.length>c-1)){d.val(f.substr(0,c));g.stopImmediatePropagation();return false}}})};(function(){var n=document,h=window;function f(d){if(typeof d=="string"){d=n.getElementById(d)}return d}function e(s,r,q){if(h.addEventListener){s.addEventListener(r,q,false)}else{if(h.attachEvent){var d=function(){q.call(s,h.event)};s.attachEvent("on"+r,d)}}}var c=function(){var d=n.createElement("div");return function(q){d.innerHTML=q;var r=d.childNodes[0];d.removeChild(r);return r}}();function m(q,d){return q.className.match(new RegExp("(\\s|^)"+d+"(\\s|$)"))}function o(q,d){if(!m(q,d)){q.className+=" "+d}}function i(q,d){var r=new RegExp("(\\s|^)"+d+"(\\s|$)");q.className=q.className.replace(r," ")}if(document.documentElement.getBoundingClientRect){var l=function(v){var d=v.getBoundingClientRect(),x=v.ownerDocument,q=x.body,y=x.documentElement,s=y.clientTop||q.clientTop||0,z=y.clientLeft||q.clientLeft||0,u=1;if(q.getBoundingClientRect){var r=q.getBoundingClientRect();u=(r.right-r.left)/q.clientWidth}if(u>1){s=0;z=0}var w=d.top/u+(window.pageYOffset||y&&y.scrollTop/u||q.scrollTop/u)-s,t=d.left/u+(window.pageXOffset||y&&y.scrollLeft/u||q.scrollLeft/u)-z;return{top:w,left:t}}}else{var l=function(q){if(h.jQuery){return jQuery(q).offset()}var r=0,d=0;do{r+=q.offsetTop||0;d+=q.offsetLeft||0}while(q=q.offsetParent);return{left:d,top:r}}}function a(s){var r,d,t,u;var q=l(s);r=q.left;t=q.top;d=r+s.offsetWidth;u=t+s.offsetHeight;return{left:r,right:d,top:t,bottom:u}}function j(s){if(!s.pageX&&s.clientX){var q=1;var d=document.body;if(d.getBoundingClientRect){var r=d.getBoundingClientRect();q=(r.right-r.left)/d.clientWidth}return{x:s.clientX/q+n.body.scrollLeft+n.documentElement.scrollLeft,y:s.clientY/q+n.body.scrollTop+n.documentElement.scrollTop}}return{x:s.pageX,y:s.pageY}}var k=function(){var d=0;return function(){return"ValumsAjaxUpload"+d++}}();function p(d){return d.replace(/.*(\/|\\)/,"")}function b(d){return(/[.]/.exec(d))?/[^.]+$/.exec(d.toLowerCase()):""}var g=function(){var d;return function(){if(d){return d}if(typeof XMLHttpRequest!=="undefined"){d=new XMLHttpRequest()}else{var r=["Microsoft.XmlHttp","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0"];for(var q=0;q<r.length;q++){try{d=new ActiveXObject(r[q]);break}catch(s){}}}return d}}();Ajax_upload=AjaxUpload=function(d,s){if(d.jquery){d=d[0]}else{if(typeof d=="string"&&/^#.*/.test(d)){d=d.slice(1)}}d=f(d);this._input=null;this._button=d;this._disabled=false;this._submitting=false;this._justClicked=false;this._parentDialog=n.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var q=jQuery(this._button).parents(".ui-dialog");if(q.length){this._parentDialog=q[0]}}this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:true,responseType:false,closeConnection:"",hoverClass:"hover",onChange:function(t,u){},onSubmit:function(t,u){},onComplete:function(t,u){}};for(var r in s){this._settings[r]=s[r]}this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(d){this._settings.data=d},disable:function(){this._disabled=true},enable:function(){this._disabled=false},destroy:function(){if(this._input){if(this._input.parentNode){this._input.parentNode.removeChild(this._input)}this._input=null;this._deleteIframe()}},_createInput:function(){var r=this;var d=n.createElement("input");d.setAttribute("type","file");d.setAttribute("name",this._settings.name);var s={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(var q in s){d.style[q]=s[q]}if(!(d.style.opacity==="0")){d.style.filter="alpha(opacity=0)"}this._parentDialog.appendChild(d);e(d,"change",function(){var t=p(this.value);if(r._settings.onChange.call(r,t,b(t))==false){return}if(r._settings.autoSubmit){r.submit()}});e(d,"click",function(){r._justClicked=true;setTimeout(function(){r._justClicked=false},2500)});this._input=d},_rerouteClicks:function(){var r=this;var s,d={top:0,left:0},q=false;e(r._button,"mouseover",function(t){if(!r._input||q){return}q=true;s=a(r._button);if(r._parentDialog!=n.body){d=l(r._parentDialog)}});e(document,"mousemove",function(w){var u=r._input;if(!u||!q){return}if(r._disabled){i(r._button,r._settings.hoverClass);u.style.display="none";return}var v=j(w);if((v.x>=s.left)&&(v.x<=s.right)&&(v.y>=s.top)&&(v.y<=s.bottom)){u.style.top=v.y-d.top+"px";u.style.left=v.x-d.left+"px";u.style.display="block";o(r._button,r._settings.hoverClass)}else{q=false;var t=setInterval(function(){if(r._justClicked){return}if(!q){u.style.display="none"}clearInterval(t)},25);i(r._button,r._settings.hoverClass)}})},_createIframe:function(){var d=k();var q=c('<iframe src="javascript:false;" name="'+d+'" />');q.id=d;q.style.display="none";n.body.appendChild(q);return q},_deleteIframe:function(){var d=k();var q=document.getElementById(d);if(q){n.body.removeChild(q);q=null}},submit:function(){var r=this,d=this._settings;if(this._input.value===""){return}var t=p(this._input.value);if(!(d.onSubmit.call(this,t,b(t))==false)){var u=this._createIframe();var s=this._createForm(u);s.appendChild(this._input);if(d.closeConnection&&/AppleWebKit|MSIE/.test(navigator.userAgent)){var q=g();q.open("GET",d.closeConnection,false);q.send("")}s.submit();n.body.removeChild(s);s=null;this._input=null;this._createInput();var v=false;e(u,"load",function(y){if(u.src=="javascript:'%3Chtml%3E%3C/html%3E';"||u.src=="javascript:'<html></html>';"){if(v){setTimeout(function(){n.body.removeChild(u)},0)}return}var w=u.contentDocument?u.contentDocument:frames[u.id].document;if(w.readyState&&w.readyState!="complete"){return}if(w.body&&w.body.innerHTML=="false"){return}var x;if(w.XMLDocument){x=w.XMLDocument}else{if(w.body){x=w.body.innerHTML;if(d.responseType&&d.responseType.toLowerCase()=="json"){if(w.body.firstChild&&w.body.firstChild.nodeName.toUpperCase()=="PRE"){x=w.body.firstChild.firstChild.nodeValue}if(x){x=window["eval"]("("+x+")")}else{x={}}}}else{var x=w}}d.onComplete.call(r,t,x);v=true;u.src="javascript:'<html></html>';"})}else{n.body.removeChild(this._input);this._input=null;this._createInput()}},_createForm:function(q){var r=this._settings;var d=c('<form method="post" enctype="multipart/form-data"></form>');d.style.display="none";d.action=r.action;d.target=q.name;n.body.appendChild(d);for(var t in r.data){var s=n.createElement("input");s.type="hidden";s.name=t;s.value=r.data[t];d.appendChild(s)}return d}}})();$(document).ready(function(){enableLinkHover($("a.makeModuleModalLink, a.helpLink"))});function enableLinkHover(a){a.hover(function(){if(!$(this).hasClass("disabled")){$(this).parents("div.panel-bar").siblings(".panel-content").addClass("panel-border")}},function(){$(this).parents("div.panel-bar").siblings(".panel-content").removeClass("panel-border")})}var PimsAction=new Object();PimsAction.Add="Add";PimsAction.Edit="Edit";PimsAction.Save="Save";PimsAction.Cancel="Cancel";PimsAction.Undo="Undo";PimsAction.Delete="Delete";PimsAction.Hide="Hide";PimsAction.MoveUp="MoveUp";PimsAction.MoveDown="MoveDown";PimsAction.RemoveMediaFile="RemoveMediaFile";PimsAction.PreviewMediaFile="PreviewMediaFile";PimsAction.ToggleVisibility="ToggleVisibility";PimsAction.CancelUpload="CancelUpload";PimsAction.CancelDocumentUpload="CancelDocumentUpload";PimsAction.RefreshModule="RefreshModule";PimsAction.ToggleEditingAutonomy="ToggleEditingAutonomy";PimsAction.SaveInSession="SaveInSession";jQuery.fn.extend({fadeDisable:function(){$(this).find("a").addClass("disabled");$(this).animate({opacity:0.3},500);return $(this)},fadeEnable:function(){$(this).find("a").removeClass("disabled");$(this).animate({opacity:1},500);return $(this)}});function preventDefault(a){a.preventDefault()}function expose(a){$("#aspnetForm").bind("submit",preventDefault);$(".module:not('#"+a.attr("id")+"')").fadeDisable()}function unexpose(a){$("#aspnetForm").unbind("submit",preventDefault);$(".module:not('#"+a.attr("id")+"')").fadeEnable()}function editModule(b,c,a,d){if(!$(b).hasClass("disabled")){performModuleAction(c,PimsAction.Edit,a,d)}}function cancelModule(b,c,a,d){performModuleAction(c,PimsAction.Cancel,a,d)}function saveModule(b,c,a,d){if($(b).hasClass("disabled")){return}if(validateForm()){clearUndoDivs();checkForPremiumNumbers(c);if(typeof doClearTreatmentUndoPanel!="undefined"&&doClearTreatmentUndoPanel!=null){doClearTreatmentUndoPanel()}if(displayFeedConfirmDialog(b,c,PimsAction.Save,a,d,null)){return}performModuleAction(c,PimsAction.Save,a,d)}else{$(".phoneChargeAmount").focus();$(".phoneChargeAmount").blur()}}function isServerValidationError(moduleGuid){var serverValidationErrors=eval("isServerValidationError"+moduleGuid);if(serverValidationErrors){return serverValidationErrors()}else{return false}}var feedManaged=false;function isFeedManaged(){return feedManaged}function setIsFeedManaged(a){feedManaged=a}var feedManagedOnSuccess=function(b,a){if(isServerValidationError(a)){return}switch(b){case PimsAction.Save:case PimsAction.Hide:case PimsAction.ToggleVisibility:hideFeedManagedSummary();setIsFeedManaged(false);break}};function hideFeedManagedSummary(){if(isFeedManaged()){$("#FeedManagedSummary").toggle(false)}}var feedManagedMessage=null;function getFeedManagedMessage(){return feedManagedMessage}function setFeedManagedMessage(a){feedManagedMessage=a}function displayFeedConfirmDialog(b,e,c,a,d,f){if(!isFeedManaged()||(getFeedManagedMessage()==null)){return false}message=getFeedManagedMessage();$(b).after($.format('<div id="dialog" title="Warning"><div class="modal-content">{0}</div></div>',[message]));$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Ok:function(){$(this).dialog("close");if((f!=null)&&(f.length>0)){performModuleActionInto(f,"module",e,c)}else{performModuleAction(e,c,a,d)}},Cancel:function(){$(this).dialog("close")}}});return true}function deleteModule(b,c,a,d){if(displayFeedConfirmDialog(b,c,PimsAction.Delete,a,d,null)){return}performModuleAction(c,PimsAction.Delete,a,d)}function hideModule(b,c,a,d){if(displayFeedConfirmDialog(b,c,PimsAction.Hide,a,d,null)){return}performModuleAction(c,PimsAction.Hide,a,d)}function moveUpModule(b,a,c){performModuleAction(b,PimsAction.MoveUp,a,c)}function moveDownModule(b,a,c){performModuleAction(b,PimsAction.MoveDown,a,c)}function undoModule(b,c,a,d){if(!$(b).hasClass("disabled")){performModuleAction(c,PimsAction.Undo,a,d)}}function addLocation(b,a,c){if(validateForm()){performModuleAction(b,PimsAction.Add,a,c)}}function saveLocations(b,c,a,d){performModuleAction(c,PimsAction.Save,a,d)}function clearUndoDivs(){$("div.panel-undo").hide()}function toggleProfileVisibility(c,b,d){if($(c).hasClass("disabled")){return}var a=PimsAction.ToggleVisibility;var e=APP_ROOT+"/UserControls/ProfileSummary/ProfileSummaryHandler.ashx?id="+b+"&a="+a+"&m="+d;if(displayFeedConfirmDialog(c,d,a,null,null,e)){return}performModuleActionInto(e,"module",d,a)}function toggleStaffVisibility(b,c,a){performModuleAction(b,PimsAction.ToggleVisibility,null,c);toggleStaffVisibilityText(a)}function toggleVisibility(a){performModuleAction(a,PimsAction.ToggleVisibility,null,null)}function refreshModule(a){performModuleAction(a,PimsAction.RefreshModule,null,null)}function toggleEditingAutonomy(a){performModuleAction(a,PimsAction.ToggleEditingAutonomy,null,null)}function performModuleAction(moduleGuid,action,itemid,subitemid){var handlerPath=eval("handler"+moduleGuid)+"&m="+moduleGuid+"&a="+action;handlerPath=handlerPath.replace("[itemid]",itemid).replace("[subitemid]",subitemid);performModuleActionInto(handlerPath,"module",moduleGuid,action)}function performModuleActionInto(handlerPath,target,moduleGuid,action){var targetElement=$("#"+target+moduleGuid);if(action==PimsAction.Save){var submitFunc=eval("onBeforeSave"+moduleGuid);if(submitFunc&&!submitFunc(moduleGuid)){return}}else{if(action==PimsAction.Delete){var onDeleteFunc=eval("onBeforeDelete"+moduleGuid);if(onDeleteFunc&&!onDeleteFunc(moduleGuid)){return}}else{if(action==PimsAction.Edit){var onEditFunc=eval("onBeforeEdit"+moduleGuid);if(onEditFunc&&!onEditFunc(moduleGuid)){return}}}}switch(action){case PimsAction.ToggleVisibility:case PimsAction.RemoveMediaFile:case PimsAction.RefreshModule:break;case PimsAction.Edit:expose(targetElement);break;default:unexpose(targetElement)}var data="";var restAction="GET";if(action==PimsAction.Save||action==PimsAction.CancelUpload||action==PimsAction.Add||action==PimsAction.CancelDocumentUpload){data=$("#aspnetForm").serialize();$(".tinymce").each(function(index){var mce=$(this).html();data+=(data.length>0?"&":"")+"RichText"+moduleGuid+"_"+index+"="+escape(mce)});var restAction="POST"}var response=$.ajax({type:restAction,url:handlerPath,data:data,cache:false,success:function(response){targetElement.html("");targetElement.replaceWith(response);$("textarea[maxlength]").maxLength();var successFunc=eval("onSuccessCallback"+moduleGuid);if(successFunc){successFunc(action,moduleGuid)}enableLinkHover($("a.makeModuleModalLink, a.helpLink"));checkForPremiumNumbers(moduleGuid)},error:function(xhr,textStatus,errorThrown){targetElement.html("<div class='handler-error'><p>"+xhr.responseText+"</p></div>");unexpose(targetElement)}})}function toggleHelper(b,a){var b=$(b);if(b.hasClass("disabled")){return}var c=$("#helper"+a);if(c.is(":visible")){b.parents("div.panel-bar").siblings(".panel-content").removeClass("panel-bordered");c.hide()}else{b.parents("div.panel-bar").siblings(".panel-content").addClass("panel-bordered");c.show()}}function registerEditInfoTip(b,a){$("#"+b).click(function(){var c=$(this).parents("div.panel-bar").siblings("div.panel-assistance-mesg");if(c.size()>0){c.remove()}else{$(this).parents("div.panel-bar").after(a)}return false})}jQuery.fn.swap=function(e){e=jQuery(e)[0];var d=this[0],c=d.cloneNode(true),f=e.cloneNode(true),g=this;d.parentNode.replaceChild(f,d);e.parentNode.replaceChild(c,e);g[0]=c;return this.pushStack(g)};function clearForm(a){$(a).find(":input").each(function(){switch(this.type){case"password":case"select-multiple":case"select-one":case"text":case"textarea":$(this).val("");break;case"checkbox":case"radio":this.checked=false}})}function initialiseHintText(b,a){if(b.val()==""){b.val(a)}b.focus(function(){if($(this).val()==a){$(this).val("")}});b.blur(function(){if($(this).val()==""){$(this).val(a)}})}function removeHintText(b,a){if(b.val()==a){b.val("")}}function toggleStaffVisibilityText(b){var d="Show this page";var e="Hide this page";b.innerHTML=(b.innerHTML==d)?e:d;var a="This page is not showing on NHS Choices. ";var c="This page now appears on NHS Choices. ";b.parentNode.firstChild.data=(b.parentNode.firstChild.data==a)?c:a}function checkForPremiumNumbers(a){var b=$("#phoneTextBox"+a);doPremiumNumberRegex(b);(b).on("input",function(){doPremiumNumberRegex(b)})}function doPremiumNumberRegex(a){validateForm();var b=new RegExp(/^084|^087|^09|^118/);var c=a.val();if(b.test(c)){$(".call-cost").show();$(".phoneChargeAmount").focus();$(".phoneChargeAmount").blur();$(a).focus()}else{$(".call-cost").hide()}};var onSuccessDelegate={onSuccessTreatment:null,onSuccessHospital:null,onSuccessDepartment:null};var onFailureDelegate={onFailureTreatment:null,onFailureHospital:null,onFailureDepartment:null,onFailureFacilitiesVisibility:null};function getModuleGuid(a){var c="listContainer";var b=$(a).parents("div[id^='"+c+"']");return b.attr("id").substr(c.length)}function getHandlerPath(eventSource){var moduleGuid=getModuleGuid(eventSource);return eval("handlerPath"+moduleGuid)}function contextSpecificValidate(eventSource){var moduleGuid=getModuleGuid(eventSource);var validationDelegate;try{validationDelegate=eval("contextSpecificValidationDelegate"+moduleGuid)}catch(err){return true}return validationDelegate()}function doEdit(a,b){if(!$(a).hasClass("disabled")){doHandlerActionCall(a,"Edit",b)}return false}function confirmSave(h,b,a,f,d,g){var c;if(!d){c=""}else{c=$("#"+d).val();if(c==null||c.length==0){c=$("#"+d).html()}}if(g=="GpPractice"){var e=$("#ODS").val();if(e!=null&&e.length>0){$(document).ready(function(){var i=$('<div id="dialog" title="Error" class="dialog-confirm"></div>').html("<p>Are you sure you want to create a new \n GP Practice using the ODS code specified?</p>").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Ok:function(){confirmAndSave(h,b,a,f,c);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});i.dialog("open")})}else{confirmAndSave(h,b,a,f,c,g)}}else{confirmAndSave(h,b,a,f,c,g)}}function confirmAndSave(f,c,a,d,b,e){if($("#HideProfile").attr("checked")&&(e!="Dentist"||$("#StopUpdate").attr("checked"))){$(f).after($.format('<div id="dialog" title="Error" class="dialog-confirm"><p>Do you really want to hide {0}?</p><p>These pages will be temporarily hidden on NHS Choices</p></div>',[b]));$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Ok:function(){doSave(f,c,a,d);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}else{doSave(f,c,a,d)}}function doSave(e,b,a,c){RemoveDefaultTextLabels(e);var f=validateForm();var d=contextSpecificValidate(e);if(f&&d){$("div.panel-undo").hide();doClearTreatmentUndoPanel();switch(c){case"AddAndPages":doHandlerActionCall(e,"SaveAndEdit",b);break;case"AddAndInvite":doHandlerActionCall(e,"SaveAndInvite",b);break;default:doHandlerActionCall(e,"Save",b);break}}return false}function RemoveDefaultTextLabels(a){$(a).parents("form:first").find("input.defLabelText").each(function(){if(jQuery(this).val()==jQuery(this).attr("defvallabel")){jQuery(this).val("")}})}function doUndo(a,b){doHandlerActionCall(a,"Undo",b);return false}function hideMessage(a){$(a).parents("div.panel-undo").hide()}function doCancel(a,b){doHandlerActionCall(a,"Cancel",b);return false}function doDelete(a,b){if(!$(a).hasClass("disabled")){$("div.panel-undo").hide();doClearTreatmentUndoPanel();doHandlerActionCall(a,"Delete",b)}return false}function doToggle(a,b){if(!$(a).hasClass("disabled")){doHandlerActionCall(a,"ToggleVisibility",b)}return false}function doAdd(a){if(!$(a).hasClass("disabled")){doHandlerActionCall(a,"Add",0)}return false}function doHandlerActionCallWithEmail(a,e,d,c){var f=$(a).parents("div.module").attr("id");var b=$.format(getHandlerPath(a),[d,e,f]);if(a&&a.value){b+="&itemid="+a.value}b+="&emailAddress="+c;doHandlerAction(b,f,e,d);return false}function doHandlerActionCall(a,e,b){var d=$(a).parents("div.module").attr("id");var c=$.format(getHandlerPath(a),[b,e,d]);if(a&&a.value){c+="&itemid="+a.value}doHandlerAction(c,d,e,b);return false}function doHandlerAction(a,j,g,e){var d;var i;var f=$("#"+j);switch(g){case"Edit":case"Add":var h=$(f).parents("div.panel-treatments");if(h.size()>0){h.removeClass("module")}expose(f);break;default:unexpose(f);var h=$(f).parents("div.panel-treatments");if(h.size()>0&&!h.hasClass("module")){h.addClass("module")}}if(g=="Save"||g=="SaveAndEdit"||g=="SaveAndInvite"){var c=f.find("div#ajax-loading");if(c.length>0){f.ajaxStart(function(){var k=$(this).width();var l=$(this).height();f.find("input").each(function(){$(this).attr("disabled","disabled")});c.css({top:((l/2)-75),left:((k/2)-70)}).fadeIn(200)}).ajaxStop(function(){$(c,this).fadeOut(1000)})}d="POST";$(".social-care-checkbox").attr("disabled","");i=$("#"+j+" *").serialize()}else{d="GET";i=""}var b=$.ajax({type:d,url:(a+"&t="+(new Date().getTime().toString())),data:i,cache:false,success:function(k){if((g=="SaveAndEdit"||g=="SaveAndInvite")&(k.length>0&k.indexOf("<div ")==-1)){window.location=FULL_PATH+k}else{$("#"+j).replaceWith(k);if(onSuccessDelegate!=null){if(onSuccessDelegate.onSuccessDepartment!=null){onSuccessDelegate.onSuccessDepartment(j,g)}if(onSuccessDelegate.onSuccessHospital!=null){onSuccessDelegate.onSuccessHospital(j,g)}if(onSuccessDelegate.onSuccessTreatment!=null){onSuccessDelegate.onSuccessTreatment(j,g)}}}},error:function(k,m,l){if(onFailureDelegate.onFailureDepartment!=null){onFailureDelegate.onFailureDepartment(j,g)}if(onFailureDelegate.onFailureHospital!=null){onFailureDelegate.onFailureHospital(j,g)}if(onFailureDelegate.onFailureTreatment!=null){onFailureDelegate.onFailureTreatment(j,g)}if(f){f.html(k.responseText)}if(g=="Toggle"&&$("div.toggleVisibility")){$("div.toggleVisibility").html(k.responseText)}unexpose(f)}})}function toggleEditor(a){$(a).parent().siblings().toggle()}function hideElementWithId(a){$("#"+a).addClass("hidden")}function showElementWithId(a){$("#"+a).removeClass("hidden")}function toggleRadios(a){$(a).parent().parent().find(':radio:not("#'+a.id+'")').each(function(){$(this).removeAttr("checked")});$("fieldset.dateset").addClass("hidden")}function showFutureDate(a){toggleRadios(a);$("fieldset.dateset").removeClass("hidden");$("input#futureDate").datepicker({minDate:1,dateFormat:"dd M yy"}).focus()}function hideFutureDateNuevo(a){$("fieldset.dateset").addClass("hidden")}function showFutureDateNuevo(a){$("fieldset.dateset").removeClass("hidden");$("input#futureDate").datepicker({minDate:1,dateFormat:"dd M yy"}).focus()}function hideThirdPartySet(a){$("#third-party-organisation-name").addClass("ignore");$("#third-party-organisation-url").addClass("ignore");$("fieldset.thirdPartySet").addClass("hidden")}function showThirdPartySet(a){$("fieldset.thirdPartySet").removeClass("hidden");$("#third-party-organisation-name").removeClass("ignore");$("#third-party-organisation-url").removeClass("ignore")}function toggleHelp(a){if($(a).children("span").hasClass("show")){$("#help-content").show();$(a).children("span").removeClass("show")}else{$("#help-content").hide();$(a).children("span").addClass("show")}}function doClearTreatmentUndoPanel(){var a=$("div.treatment-updated");if(a.size()>0){if(a.hasClass("treatment-deleted")){a.remove()}else{$("div.treatment-title",a).find("span").remove();$(a).removeClass("treatment-updated")}}};var vemap=null;var infoBoxTitle=null;var infoBoxDescription=null;var pushpinIsDraggable=false;var latitude=0;var longitude=0;function doInitializeMap(a){doInitializeMap(a,VEDashboardSize.Normal)}function doInitializeMap(b,a){vemap=new VEMap(b);vemap.SetCredentials(mapKey);vemap.SetDashboardSize(a);vemap.LoadMap(new VELatLong(54.5,-4),4,VEMapStyle.Road)}function doFind(b,d,c,a){infoBoxTitle=d;infoBoxDescription=c;pushpinIsDraggable=a=="True";vemap.Find(null,b,null,null,null,null,null,null,null,null,onFindComplete)}function doFindByCoordinates(e,b,c,a,f){infoBoxTitle=c;infoBoxDescription=a;pushpinIsDraggable=f=="True";var d=new VELatLong(e,b);vemap.SetCenterAndZoom(d,15);setPushpin(d)}function onFindComplete(d,b,e,c,f){if(e==null){alert((f==null)?"There were no results found":f);return}var g=e[0];var a=g.LatLong;vemap.SetZoomLevel(15);setPushpin(a)}function setPushpin(b){var a=new VEShape(VEShapeType.Pushpin,b);a.SetTitle(infoBoxTitle);a.SetDescription(infoBoxDescription);a.Draggable=pushpinIsDraggable;if(pushpinIsDraggable){a.onenddrag=EndDragHandler}vemap.AddShape(a)}function EndDragHandler(a){latitude=a.LatLong.Latitude;longitude=a.LatLong.Longitude;appendLatLongToHandlerPath()}function appendLatLongToHandlerPath(moduleGuid){var handlerPath=eval("handler"+moduleGuid);var latIndex=handlerPath.indexOf("latitude");if(latIndex==-1){handlerPath=handlerPath+"&latitude="+latitude}else{handlerPath=handlerPath.replace(/latitude=[\d\.\-]+/i,"latitude="+latitude)}var longIndex=handlerPath.indexOf("longitude");if(longIndex==-1){handlerPath=handlerPath+"&longitude="+longitude}else{handlerPath=handlerPath.replace(/longitude=[\d\.\-]+/i,"longitude="+longitude)}eval("handler"+moduleGuid+'="'+handlerPath+'"')}function resetPushpin(){$(".resetpin a").click(function(event){event.preventDefault();latitude=0;longitude=0;appendLatLongToHandlerPath();vemap.Clear();doFind(eval("originalPostcode"),infoBoxTitle,infoBoxDescription,pushpinIsDraggable?"True":"False")})};function doSetUpLinkHover(){$("div.panel-bar > ul > li > a",$("div.box-list")).hover(function(){if(!$(this).hasClass("disabled")){$(this).parents("div.panel-bar").siblings("div.panel-content").addClass("panel-border")}},function(){$(this).parents("div.panel-bar").siblings("div.panel-content").removeClass("panel-border")})}function doSetUpListItems(){$("div.box-list").each(function(){$("div.panel:even",this).removeClass("last");$("div.panel:odd",this).addClass("last")});doSetUpLinkHover()}function doPromote(a,b){var c=$("input:checked",$(a).parents(".hospital-list")).size();if(c>5){$(a).after('<div id="dialog" class="modal-content modal-error" title="Error"><p>You can only promote 5 hospitals on your overview page.</p></div>');$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,dialogClass:"ui-one-button",buttons:{OK:function(){$(this).dialog("close")}}});$(a).attr("checked","");return false}doHandlerActionCall(a,"Promote",b);return false}function doExpandEditor(a,d){var b=$("#"+a);var c=b.hasClass("last")?c=$(b).prev("div.panel"):c=$(b).next("div.panel");c=$(c);if((d=="Edit"||d=="Add")&&b.hasClass("panel-edit-full")){if(c.size()){c.addClass("hidden")}}if(d=="Cancel"||d=="Save"){if(c.size()){c.removeClass("hidden")}}}function doSetUpHiddenHospitalsLink(){var a=$("#toggleHiddenHospitals");if(a.size()>0){a.click(function(){doToggleHiddenHospitalsListVisibility()})}}function doToggleHiddenHospitalsListVisibility(){var a=$("#hiddenHospitalsList");var c=$("#toggleHiddenHospitals");if(a.size()>0&&c.size()>0){var b=$("div.module",a).size();if(a.hasClass("hidden")){c.text("Hidden Hospitals");a.removeClass("hidden");c.addClass("hide")}else{c.text("Hidden Hospitals ("+b+")");a.addClass("hidden");c.removeClass("hide")}}}if(!onSuccessDelegate){var onSuccessDelegate={onSuccessTreatment:null,onSuccessHospital:null,onSuccessDepartment:null}}onSuccessDelegate.onSuccessHospital=function(a,b){doExpandEditor(a,b);if(b=="Save"){repositionHospitalModule(a)}doSetUpListItems()};onFailureHospital=function(a,d){var c=$("#HospitalName").val();var b="We're sorry, we've had some trouble setting up this {0} \n";b+="We just need to make sure this {1} isn't already on NHS Chocies, and doesn't match any existing ODS codes we already have. Please <a href={2}>email or ring our help desk </a> and they'll fix this problem.";b+=$.format(b,[c,c,c]);$(a).after('<div id="dialog" title="Error"><p>'+b+"</p></div>");$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,buttons:{OK:function(){$(this).dialog("close")}}})};function repositionHospitalModule(a){var e=$("#"+a);var b=$("input:checkbox[name='PromoteHospital']",e).size()==1;var g=$("div#visibleHospitalsList");var f=$("div#hiddenHospitalsList");var d=e.parents("div.box-list").attr("id");if(b==false&&d=="visibleHospitalsList"){if(f.size()==0){g.after('<p><a id="toggleHiddenHospitals" href="javascript:void(0);">Hidden Hospitals</a> - these are not displayed to the public</p><div id="hiddenHospitalsList" class="box-list clear"></div>');f=$("div#hiddenHospitalsList");doSetUpHiddenHospitalsLink()}f.append(e);if(f.hasClass("hidden")){var c=$("div.module",f).size();$("#toggleHiddenHospitals").text("Hidden Hospitals ("+c+")")}}else{if(b==true&&d=="hiddenHospitalsList"){$("div.module:last",g).before(e);if(f.size()==1&&$("div.module",f).size()==0){f.prev().remove();f.remove()}}}if(g.size()==1){$(".module",g).tsort("h3",{order:"asc"})}if(f.size()==1){$(".module",f).tsort("h3",{order:"asc"})}}$(document).ready(function(){doSetUpListItems();doSetUpHiddenHospitalsLink();doToggleHiddenHospitalsListVisibility()});function doSetUpHiddenClinicsLink(){var a=$("#toggleHiddenClinics");if(a.size()>0){a.click(function(){doToggleHiddenClinicsListVisibility()})}}function doToggleHiddenClinicsListVisibility(){var a=$("#hiddenClinicsList");var b=$("#toggleHiddenClinics");if(a.size()>0&&b.size()>0){var c=$("div.module",a).size();if(a.hasClass("hidden")){b.text("Hidden Clinics");a.removeClass("hidden");b.addClass("hide")}else{b.text("Hidden Clinics ("+c+")");a.addClass("hidden");b.removeClass("hide")}}}$(document).ready(function(){doSetUpHiddenClinicsLink();doToggleHiddenClinicsListVisibility()});function ToggleHiddenServiceLink(){var a=$("#toggleHiddenServiceLink");if(a.size()>0){a.click(function(){ToggleHiddenServicesList()})}}function ToggleHiddenServicesList(){var f=$("tr.invisible-department");var c=$("#toggleHiddenServiceLink");var e=$("#org-title");if(e.length===0){return}var d=e.attr("class").split(" ")[0];var b=d=="care-organisation"?b="Hidden Services":b="Hidden Departments";if(f.size()>0&&c.size()>0){var a=$("div.module",f).size();if(f.hasClass("hidden")){c.text(b);f.removeClass("hidden")}else{c.text(b+" ("+a+")");f.addClass("hidden")}}}function doSetUpServiceListItems(){$("div.box-list > div.panel:even").removeClass("last");$("div.box-list > div.panel:odd").addClass("last")}function doExpandServicesEditor(a,d){var b=$("#"+a);var c=b.hasClass("last")?c=$(b).prev("div.panel"):c=$(b).next("div.panel");c=$(c);if((d=="Edit"||d=="Add")&&b.hasClass("panel-edit-full")){if(c.size()){c.addClass("hidden")}}if(d=="Cancel"||d=="CancelAdd"){if(c.size()){c.removeClass("hidden")}}}function repositionServiceModule(a){var e=$("#"+a);var b=$("input:checkbox[name='PromoteHospital']",e).size()==1;var g=$("div#visibleHospitalsList");var f=$("div#hiddenHospitalsList");var d=e.parents("div.box-list").attr("id");if(b==false&&d=="visibleHospitalsList"){if(f.size()==0){g.after('<p><a id="toggleHiddenHospitals" href="javascript:void(0);">Hidden Hospitals</a> - these are not displayed to the public</p><div id="hiddenHospitalsList" class="box-list clear"></div>');f=$("div#hiddenHospitalsList");doSetUpHiddenHospitalsLink()}f.append(e);if(f.hasClass("hidden")){var c=$("div.module",f).size();$("#toggleHiddenHospitals").text("Hidden Hospitals ("+c+")")}}else{if(b==true&&d=="hiddenHospitalsList"){$("div.module:last",g).before(e);if(f.size()==1&&$("div.module",f).size()==0){f.prev().remove();f.remove()}}}if(g.size()==1){$(".module",g).tsort("h3",{order:"asc"})}if(f.size()==1){$(".module",f).tsort("h3",{order:"asc"})}}onSuccessDelegate.onSuccessDepartment=function(a,b){doSetUpServiceListItems();doExpandServicesEditor(a,b)};function checkOrganisationServiceProviders(a){a=$(a);var b=$("#provided-by-third-party").length>0;if(!b){return}var d=$("#provided-by-third-party");var c=$("#provided-by-trust");if(a.attr("id")=="provided-by-third-party"){if(!c.attr("disabled")){c.attr("checked",false)}$("#service-hospital-selection :input").each(function(){if(!$(this).attr("disabled")){$(this).attr("checked",false)}});return true}if(a.attr("id")=="provided-by-trust"){if(!d.attr("disabled")){d.attr("checked",false);$("#third-party-organisation-name").val("Enter name of organisation");$("#third-party-organisation-url").val("Enter organisation URL (optional)")}$("#service-hospital-selection :input").each(function(){if(!$(this).attr("disabled")){$(this).attr("checked",false)}});return true}if(a.attr("class")=="hospital-provider"){if(!d.attr("disabled")){d.attr("checked",false);$("#third-party-organisation-name").val("Enter name of organisation");$("#third-party-organisation-url").val("Enter organisation URL (optional)")}if(!c.attr("disabled")){c.attr("checked",false)}return true}c.attr("checked",false);d.attr("checked",false)}$(document).ready(function(){doSetUpServiceListItems();ToggleHiddenServiceLink();ToggleHiddenServicesList()});jQuery.validator.addMethod("trustservicehospitals",function(b,a){return validateHospitals()});jQuery.validator.addClassRules("trustservicehospitals",{trustservicehospitals:true});jQuery.validator.messages.trustservicehospitals="";function validateHospitals(){var a=$("#provided-by-third-party").length>0;var b=a?"Please select either at least one hospital, a trust or a third party that manages the service":"Please select at least one location";while($(".hospitals").siblings(":last").attr("class")=="panel-assistance-mesg panel-error clear"){$(".hospitals").siblings(":last").remove()}var c=$(".service-locations input:not([disabled]):checked").length>0;if(!$(".hospital-provider").hasClass("social-care-checkbox")){if(!c){$(".hospitals").siblings(":last").after('<div class="panel-assistance-mesg panel-error clear"><p>'+b+"</p></div>");return false}}if(a&&$("#provided-by-third-party").attr("checked")){if($.trim($("#third-party-organisation-name").val()).length<1||$("#third-party-organisation-name").val()==="Enter name of organisation"){$(".hospitals").siblings(":last").after('<div class="panel-assistance-mesg panel-error clear"><p>Please specify a third party organisation name</p></div>');return false}}return true}function deleteTrustService(a,b){$("#deleteservicelink").after('<div id="dialog" title="Error" class="dialog-confirm"><p><strong>Delete department or service</strong></p><p>Are you sure you want to delete this department and/or service?</p><p>This will delete this service for every location that currently displays it.</p><p>This action cannot be undone.</p></div>');showDeleteConfirmationDialog(a,b,true)}function deleteTrustLocation(a,b,c){if(c){$("#deletelocationlink").after('<div id="dialog" title="Error" class="dialog-confirm"><p><strong>Delete location</strong></p><p>This location cannot be deleted because it has services associated with it. Remove the services on the departments and services tab before continuing.</p></div>');showDeleteConfirmationDialog(a,b,false)}else{$("#deletelocationlink").after('<div id="dialog" title="Error" class="dialog-confirm"><p><strong>Delete location</strong></p><p>Are you sure you want to delete this location?</p><p>This action cannot be undone.</p></div>');showDeleteConfirmationDialog(a,b,true)}}function showDeleteConfirmationDialog(a,b,c){if(c){$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Cancel:function(){$(this).dialog("close")},Delete:function(){doDelete(a,b);$(this).dialog("close")}}})}else{$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Cancel:function(){$(this).dialog("close")}}})}};onSuccessDelegate.onSuccessTreatment=function(a,c){if(c=="Save"){var b=$("#"+a);$("div.module:has(div.treatment-title)",b.parent("div")).tsort("div.treatment-title",{order:"asc"})}};function changeManager(a,b){var c=$('a[id="email'+a.value+'"]').attr("href").split(":")[1];doHandlerActionCallWithEmail(a,"ChangeManager",b,c);return false}function confirmDeleteEditor(a,b,c){$(a).after($.format('<div id="dialog" title="Error"><div class="modal-content"><p>Are you sure you want to remove editor rights for {0}?</p><p>An email notification will be sent to {1}</p></div></div>',[c,c]));$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Ok:function(){doHandlerActionCall(a,"Delete",b);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});return false}function confirmChangeManager(a,b,c){$(a).after($.format('<div id="dialog" title="Error"><div class="modal-content"><p>Do you want to give {0} manager rights for {1}</p><p>An email notification will be sent to {2}</p></div></div>',c));$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Ok:function(){changeManager(a,b);$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});return false}function confirmDelegateEditingRights(a,b,c){clearUndoDivs();$(a).after($.format('<div id="dialog" title="Error"><div class="modal-content"><p>Are you sure you want to change the editing rights for {0}?</p><p>An email notification will be sent to the Trust Manager</p></div></div>',c));$("#dialog").dialog({bgiframe:true,modal:true,draggable:false,resizable:false,width:330,buttons:{Ok:function(){toggleEditingAutonomy(b);$(this).dialog("close")},Cancel:function(){$("#ToggleAutonomyCheckbox").attr("checked",!$("ToggleAutonomyCheckbox").attr("checked"));$(this).dialog("close")}}});return false};$(document).ready(function(){serviceLocationsInitialiseDisplayElements()});var serviceLocationsInitialiseDisplayElements=function(){serviceLocationsSetAlternatingClasses();serviceLocationsChangeAddText();hideMoveControls("service-locations-edit")};var serviceLocationsOnBeforeDelete=function(a){serviceLocationsClearUndoPanels(a);return true};var serviceLocationsOnBeforeEdit=function(a){serviceLocationsClearUndoPanels(a);return true};var serviceLocationsOnSuccess=function(a,b){switch(a){case PimsAction.MoveUp:serviceLocationsClearUndoPanels(b);move(b,"up");break;case PimsAction.MoveDown:serviceLocationsClearUndoPanels(b);move(b,"down");break;case PimsAction.Delete:var c=$("#module"+b);$(".panel-bar",c).hide();$(".panel-content",c).hide();c.addClass("deleted-contact");break}serviceLocationsInitialiseDisplayElements()};var serviceLocationsSetAlternatingClasses=function(){$("div.service-locations-edit > .panel-edit:even").removeClass("last");$("div.service-locations-edit > .panel-edit:odd").addClass("last");$("div.service-locations > .panel:even").removeClass("last");$("div.service-locations > .panel:odd").addClass("last")};var serviceLocationsChangeAddText=function(){var a=$("div.service-locations-edit .module .panel-content").length==0?"Add address and phone number":"Add another address and phone number";$("div.service-locations-edit li.add span").html(a)};var serviceLocationsClearUndoPanels=function(a){var b=$("#module"+a).parent();$(".panel-undo",b).hide();$(".deleted-contact",b).remove();serviceLocationsSetAlternatingClasses()};var registrationDateHintText="dd/mm/yyyy";var ourTeamMembersOnSuccess=function(b,e){summaryAndPhotoOnSuccess(b,e);var h=$("#"+e+"_RegistrationDateTextBox");var g=$("#"+e+"_MembershipBodySelect");var f=$("#"+e+"_ProfessionalBodyMembershipNumberTextBox");initialiseHintText(h,registrationDateHintText);d();g.change(d);if(b==PimsAction.Delete){var a=$("#module"+e);$(".panel-bar",a).hide();$(".panel-content",a).hide();a.addClass("deleted-member")}function d(){var i=$("#"+e+"_NoneMembershipBodyIdField").val();if(g.val()==""||g.val()==i){f.attr("disabled",true);f.val("")}else{f.removeAttr("disabled")}}jQuery.validator.addMethod("professionalBodyMembershipNumber",c,"Please enter a valid membership number");function c(i,l,k){var j=$('#[id$="_MembershipBodySelect"] :selected').text();var p=i;var o=[];var n=[];jQuery.each(k,function(r,s){o[r]=s.substring(0,s.indexOf("|"));n[r]=s.substring(s.indexOf("|")+1)});if(o!=null){var q=o.join().indexOf(j);if(q!=-1){var m=new RegExp(n[q]);return p.match(m)}}return true}};var ourTeamMembersOnBeforeSave=function(a){removeHintText($("#"+a+"_RegistrationDateTextBox"),registrationDateHintText);return true};function toggleFieldsOnSelect(i,a){var g=$(i).attr("id");var e=$(i).find("option:selected");var c=$.trim($(e).text());var f=$("#"+a+"_GMCTextBoxDiv");var h=$("#"+a+"_SpecialInterestsTextBoxDiv");var b=$("#"+a+"_JobTitleOther");var d=$(".staff-quals");if(g==a+"_StaffType"){if(c!="Doctor"){f.removeClass("hidden");h.removeClass("hidden");d.removeClass("hidden");f.addClass("hidden");h.addClass("hidden");d.addClass("hidden")}else{f.removeClass("hidden");h.removeClass("hidden");d.removeClass("hidden")}}if(g==a+"_GpMemberJobTitle"){if(c!="Other"){b.removeClass("hidden");b.addClass("hidden")}else{b.removeClass("hidden")}}}function addRemoveRow(j,b){var n=$(".row-item").length;var g=n++;var i="YYYY";var m="Location";var d="";var c="";var l=$(j);var a=l.parent("p.add-row").siblings(".row-item:first");var f=a.attr("id");var h=f.slice(0,-2);var k=a.clone();k.attr("id",h+"_"+g);k.find("label").each(function(){$(this).attr("for",$(this).attr("for").slice(0,-2)+"_"+g)});k.find("input, select, textarea").each(function(){$(this).attr("id",$(this).attr("id").slice(0,-2)+"_"+g);$(this).attr("name",$(this).attr("name").slice(0,-2)+"_"+g)});k.find("select[id*=_staffQualification], select[id*=_staffLocation]").each(function(){$(this).find("option").removeAttr("selected");$(this).find("option[value=null]").attr("selected","selected")});k.find("input[id*=_staffQualificationYear_]").each(function(){$(this).attr("value",i)});k.find("input[id*=_staffQualificationLocation_]").each(function(){$(this).attr("value",m)});k.find("input[id*=_staffQualificationPrimary_]").each(function(){$(this).attr("checked",false)});k.find("textarea[id*=_staffLocationDaysTimes]").each(function(){$(this).text(d)});k.find("input[id*=_DisplayOrderTextBox]").each(function(){$(this).attr("value",c)});k.children("p.remove-row").show();k.children("div[class*=panel-error]").hide();k.insertBefore(l.parent("p.add-row"));k.find("input[id*=_staffQualificationYear_], input[id*=_staffQualificationLocation_]").each(function(){var e=$(this).val();$(this).focus(function(){if($(this).val()==i||$(this).val()==m){$(this).val("")}});$(this).blur(function(){if($(this).val()==""){$(this).val(e)}})})}$("a.remove-row").live("click",function(){var b=$(this).parent("p").parent("div[class*=row-item]");var a=$(this).parent("p").parent("div[class*=row-item]").attr("id");b.addClass("hidden");b.attr("id","hidden_"+a);b.find("input, select, textarea").each(function(){$(this).attr("id","hidden_"+$(this).attr("id"));$(this).attr("name","hidden_"+$(this).attr("name"))});return false});var ourGpTeamMembersOnSuccess=function(a,b){summaryAndPhotoOnSuccess(a,b);if(a==PimsAction.Delete){var c=$("#module"+b);$(".panel-bar",c).hide();$(".panel-content",c).hide();c.addClass("deleted-member")}};$(document).ready(function(){additionalContactsInitialiseDisplayElements()});var additionalContactsInitialiseDisplayElements=function(){additionalContactsSetAlternatingClasses();additionalContactsChangeAddText();hideMoveControls("additional-contacts-edit")};var additionalContactsOnBeforeDelete=function(a){additionalContactsClearUndoPanels(a);return true};var additionalContactsOnBeforeEdit=function(a){additionalContactsClearUndoPanels(a);return true};var additionalContactsOnSuccess=function(a,b){switch(a){case PimsAction.MoveUp:additionalContactsClearUndoPanels(b);move(b,"up");break;case PimsAction.MoveDown:additionalContactsClearUndoPanels(b);move(b,"down");break;case PimsAction.Delete:var c=$("#module"+b);$(".panel-bar",c).hide();$(".panel-content",c).hide();c.addClass("deleted-contact");break}additionalContactsInitialiseDisplayElements()};var additionalContactsSetAlternatingClasses=function(){$("div.additional-contacts-edit > .panel-edit:even").removeClass("last");$("div.additional-contacts-edit > .panel-edit:odd").addClass("last");$("div.additional-contacts > .panel:even").removeClass("last");$("div.additional-contacts > .panel:odd").addClass("last")};function move(c,d){var e=$("#module"+c);var f=e.parent().children(".panel-edit");for(var a=0;a<f.length;a++){if(f[a].id==e[0].id){break}}if((d=="up"&&a>0)||(d=="down"&&a<f.length-1)){var b=d=="up"?f[a-1]:f[a+1];$(e.selector).swap("#"+b.id)}}var additionalContactsChangeAddText=function(){var a=$("div.additional-contacts-edit .module").length==0?"Add a contact":"Add an additional contact";$("div.additional-contacts-edit li.add span").html(a)};function hideMoveControls(b){var a=$("div."+b).children(".edit-box");$("li.move, li.move-up, li.move-down",a).removeClass("hidden");if(a.length==0){return}var c=a[0];if(c.length==0){return}var d=a[a.length-1];if(c.id==d.id){$("li.move",c).addClass("hidden")}else{$("li.move-up",c).addClass("hidden");$("li.move-down",d).addClass("hidden")}}var additionalContactsClearUndoPanels=function(a){var b=$("#module"+a).parent();$(".panel-undo",b).hide();$(".deleted-contact",b).remove();additionalContactsSetAlternatingClasses()};var PimsTinyMCEOptions={script_url:"/includes/pims/tinyMCE/tiny_mce.js",mode:"textareas",relative_urls:false,theme:"advanced",content_css:"/css/pims/pims-admin.css",button_tile_map:true,nowrap:false,cleanup:true,force_p_newlines:false,plugins:"safari,style,maxchars,visualchars,paste",theme_advanced_buttons1:"bold,italic,link,unlink,bullist,numlist",theme_advanced_buttons2:"",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_resizing:true,paste_auto_cleanup_on_paste:true,paste_remove_spans:true,paste_remove_styles:true,paste_block_drop:true,invalid_elements:"script,xml,style,h2,h3,h1",handle_event_callback:"handleMCEEvent",oninit:"handleMCEEvent"};function configureTinyMCE(a){$("textarea[id="+a+"]").tinymce(PimsTinyMCEOptions)}function handleMCEEvent(a){validateMCE(false);return true};function removeImage(c){var b=PimsAction.RemoveMediaFile;var a=getImageUploadHandlerPath(c,b);performModuleActionInto(a,"imageContent",c,b)}var summaryAndPhotoOnSuccess=function(b,a){if(b==PimsAction.Edit||b==PimsAction.CancelUpload||b==PimsAction.RemoveMediaFile||b==PimsAction.PreviewMediaFile){createAjaxImageUpload(a)}};function createAjaxImageUpload(moduleGuid){var handler=getImageUploadHandlerPath(moduleGuid,PimsAction.PreviewMediaFile);var module=$("#imageContent"+moduleGuid);var parentModule=$("#module"+moduleGuid);var savePanel=parentModule.find("div.panel-save");var au=new AjaxUpload("#changeImageLink"+moduleGuid,{action:handler,autoSubmit:true,onChange:function(file,extension){},onSubmit:function(file,extension){eval("au"+moduleGuid+" = this;");if(!isImageFile(extension)){$("#fileUploadErrorDiv"+moduleGuid).removeClass("hidden");return false}$("#fileUploadErrorDiv"+moduleGuid).addClass("hidden");if($("#imageDescription"+moduleGuid).length){var arr=[];arr["imageDescription"+moduleGuid]=$("#imageDescription"+moduleGuid).val();this.setData(arr)}var html="<h3>Image loading</h3><br /> ";html+="<img src='/img/pims/admin/loading-animation.gif' class='image-uploading' /> ";html+="<p class='image-cancel'><a href='javascript:void(0);' onclick=\"cancelImageUpload('"+moduleGuid+"')\" id='cancelImageLink"+moduleGuid+"'>Cancel</a></p>";module.html(html);savePanel.fadeDisable()},onComplete:function(file,response){this.destroy();module.replaceWith(response);createAjaxImageUpload(moduleGuid);savePanel.fadeEnable()}})}function cancelImageUpload(moduleGuid){var au=eval("au"+moduleGuid);au.destroy();performModuleAction(moduleGuid,PimsAction.CancelUpload,0,0)}function isImageFile(a){return(a=="jpg"||a=="jpeg"||a=="png"||a=="gif")}function getImageUploadHandlerPath(c,b){var a="";if(($("#imageContent"+c).parents(".img-gallery")).length!=0){a="/UserControls/CareProviders/PhotoGallery/PhotoGalleryPhotoUploadHandler.ashx"}else{a="/UserControls/SummaryAndPhoto/ImageUploadHandler.ashx"}return APP_ROOT+a+"?a="+b+"&m="+c+"&d="+(new Date().getTime().toString())};$(".toggle-branch-desc").live("click",function(){var e='<button class="toggle-branch-desc" id="use-main" type="button" value="Use description from main branch">Use description from main branch</button>';var i='<button class="toggle-branch-desc" id="use-main-confirm" type="button" value="Yes, use a copy of this text">Yes, use a copy of this text</button>';var d='<button class="toggle-branch-desc" id="cancel" type="button" value="Cancel">Cancel</button>';var a=$(".panel-text").children("h3");var c=$(".mceToolbar.mceToolbarRow1").parent("td").parent("tr");var j=$("textarea.branch-desc");var b=$(".button-row");var f=$(this).attr("id");var h=$("input#customDescHolder");var g=$("input#mainBranchDescHolder");switch(f){case"use-main":h.val(j.val());j.val(g.val());c.hide();a.after("<p><em>This text is currently being used by your main branch</em></p>");b.html(i+d);break;case"use-main-confirm":c.show();a.siblings("p").remove();b.html("<p><strong>You are using the main branch description</strong></p>");break;case"cancel":j.val(h.val());c.show();a.siblings("p").remove();b.html(e);break}});function removePdf(c){var b=PimsAction.RemoveMediaFile;var a=getPdfUploadHandlerPath(c,b);performModuleActionInto(a,"pdfContent",c,b)}var pdfUploadOnSuccess=function(b,a){if(b==PimsAction.Edit||b==PimsAction.RemoveMediaFile||b==PimsAction.PreviewMediaFile){createAjaxPdfUpload(a)}};function createAjaxPdfUpload(moduleGuid){var handler=getPdfUploadHandlerPath(moduleGuid,PimsAction.PreviewMediaFile);var module=$("#pdfContent"+moduleGuid);var parentModule=$("#module"+moduleGuid);var savePanel=parentModule.find("div.panel-save");var au=new AjaxUpload("#changePdfLink"+moduleGuid,{action:handler,autoSubmit:true,onChange:function(file,extension){},onSubmit:function(file,extension){eval("au"+moduleGuid+" = this;");if(!isPdfFile(extension)){$("#pdfUploadErrorDiv"+moduleGuid).removeClass("hidden");return false}$("#pdfUploadServerErrorDiv"+moduleGuid).addClass("hidden");$("#pdfUploadErrorDiv"+moduleGuid).addClass("hidden");if($("#pdfDescription"+moduleGuid).length){var arr=[];arr["pdfTitle"+moduleGuid]=$("#pdfTitle"+moduleGuid).val();arr["pdfDescription"+moduleGuid]=$("#pdfDescription"+moduleGuid).val();this.setData(arr)}var html="<h3>File Loading</h3><br /> ";html+="<img src='/img/pims/admin/loading-animation.gif' class='image-uploading' /> ";html+="<p class='image-cancel'><a href='#' onclick=\"cancelPdfUpload('"+moduleGuid+"')\" id='cancelPdfLink"+moduleGuid+"'>Cancel</a></p>";module.html(html);savePanel.fadeDisable()},onComplete:function(file,response){this.destroy();module.replaceWith(response);createAjaxPdfUpload(moduleGuid);savePanel.fadeEnable()}})}function cancelPdfUpload(moduleGuid){var au=eval("au"+moduleGuid);au.destroy();performModuleAction(moduleGuid,PimsAction.Edit,null,null)}function isPdfFile(a){return(a=="pdf")}function getPdfUploadHandlerPath(a,b){return APP_ROOT+"/UserControls/PdfUpload/PdfUploadHandler.ashx?a="+b+"&m="+a+"&d="+(new Date().getTime().toString())};function removeDoc(c){var b=PimsAction.RemoveMediaFile;var a=getDocUploadHandlerPath(c,b);performModuleActionInto(a,"docContent",c,b)}var docUploadOnSuccess=function(b,a){if(b==PimsAction.Edit||b==PimsAction.RemoveMediaFile||b==PimsAction.PreviewMediaFile){createAjaxDocUpload(a)}};function createAjaxDocUpload(moduleGuid){var handler=getDocUploadHandlerPath(moduleGuid,PimsAction.PreviewMediaFile);var module=$("#docContent"+moduleGuid);var parentModule=$("#module"+moduleGuid);var savePanel=parentModule.find("div.panel-save");var au=new AjaxUpload("#changeDocLink"+moduleGuid,{action:handler,autoSubmit:true,onChange:function(file,extension){},onSubmit:function(file,extension){eval("au"+moduleGuid+" = this;");if(!isDocFile(extension)){$("#docUploadErrorDiv"+moduleGuid).removeClass("hidden");return false}$("#docUploadServerErrorDiv"+moduleGuid).addClass("hidden");$("#docUploadErrorDiv"+moduleGuid).addClass("hidden");if($("#docDescription"+moduleGuid).length){var arr=[];arr["docTitle"+moduleGuid]=$("#docTitle"+moduleGuid).val();arr["docDescription"+moduleGuid]=$("#docDescription"+moduleGuid).val();this.setData(arr)}var html="<h3>File Loading</h3><br /> ";html+="<img src='/img/pims/admin/loading-animation.gif' class='image-uploading' /> ";html+="<p class='image-cancel'><a href='#' onclick=\"cancelDocUpload('"+moduleGuid+"')\" id='cancelDocLink"+moduleGuid+"'>Cancel</a></p>";module.html(html);savePanel.fadeDisable()},onComplete:function(file,response){this.destroy();module.replaceWith(response);createAjaxDocUpload(moduleGuid);savePanel.fadeEnable()}})}function cancelDocUpload(moduleGuid){var au=eval("au"+moduleGuid);au.destroy();performModuleAction(moduleGuid,PimsAction.Edit,null,null)}function isDocFile(a){return(a=="doc"||a=="pdf"||a=="xls"||a=="docx"||a=="xlsx")}function getDocUploadHandlerPath(a,b){return APP_ROOT+"/UserControls/DocUpload/DocUploadHandler.ashx?a="+b+"&m="+a+"&d="+(new Date().getTime().toString())};function incrementHitCounter(a){var c=APP_ROOT+"/UserControls/ProfileSummary/HitCounterHandler.ashx?a="+PimsAction.Save+"&id="+a;var b=$.ajax({type:"GET",url:c,data:"",cache:false,success:function(d){}})};var refreshFacilitiesVisibilityControl=function(){var a=$("#FacilitiesVisibilityControlModuleGuid").val();refreshModule(a)};var resetFaciltitiesTabText=function(c){var b=$("#facilities-tab-text");var a=" (not published)";b.text(c?b.text()+a:b.text().replace(a,""))};JSLINQ.fn.DistinctFirst=function(a){var d;var b=new Object();var e=new Array();for(var c=0;c<this.items.length;c++){d=a(this.items[c]);if(b[d]==null){b[d]=true;e[e.length]=this.items[c]}}b=null;return new JSLINQ(e)};var _viewAccountItems;function initialiseViewAccounts(a){_viewAccountItems=JSLINQ(a);populateOrganisationType()}function populateOrganisationType(){populateOrganisationTypes(true);populateOrganisationTypes(false);populateServices();populateResultsList()}function populateOrganisationTypes(c){var a=$("#organisation-type-dropdown");if(c){a.addOption("","(show all)")}var b=_viewAccountItems.Where(function(d){return d.ItemTypeName!="Service"&&d.IsTrust==c}).Distinct(function(d){return d.ItemTypeNamePlural}).ToArray();if(b.length==0){return}$.each(b,function(e,d){a.addOption(d,d)})}function populateServices(){var a=$("#service-dropdown");a.addOption("","(all)");var b=_viewAccountItems.Where(function(c){return c.ItemType=="Service"}).Distinct(function(c){return c.ItemName}).ToArray();$.each(b,function(d,c){a.addOption(c,c)})}function onOrganisationTypeSelected(){var a=$("#organisation-dropdown");a.find("option").remove();a.addOption("","(show all)");var b=$("#organisation-type-dropdown").val();var c=_viewAccountItems.Where(function(d){return d.ItemTypeNamePlural==b}).DistinctFirst(function(d){return d.ItemName}).OrderBy(function(d){return d.ItemName}).ToArray();$.each(c,function(e,d){a.addOption(d.Id,d.ItemName)});if(b.length>0){a.attr("disabled","")}else{a.attr("disabled","disabled").attr("selectedIndex",0)}if(b.length==0||(b.length>0&&_viewAccountItems.First(function(d){return d.ItemTypeNamePlural==b}).IsTrust)){$("#service-dropdown").attr("disabled","")}else{$("#service-dropdown").attr("disabled","disabled").attr("selectedIndex",0)}populateResultsList()}function onServiceSelected(){if($("#service-dropdown").val().length>0){$("#organisation-dropdown").attr("selectedIndex",0)}populateResultsList()}function onOrganisationSelected(){if($("#organisation-dropdown").val().length>0){$("#service-dropdown").attr("selectedIndex",0)}populateResultsList()}function populateResultsList(){var h=_viewAccountItems;var f=$("#organisation-type-dropdown").val();var k=$("#organisation-dropdown").val();var e=$("#service-dropdown").val();var c=$("#role-dropdown").val();if(f.length>0&&e.length==0&&k.length==0){h=h.Where(function(l){return l.ItemTypeNamePlural==f})}if(k.length>0){h=h.Where(function(l){return l.Id==k||l.TrustId==k})}if(e.length>0){h=h.Where(function(l){return l.ItemName==e})}if(c.length>0){h=h.Where(function(l){return l.RoleType==c})}h=h.ToArray();var a=$("#results");a.children().remove();var b=$("#result-template").clone();var d;var j;var g=null;var i=null;$.each(h,function(m,l){i=l.Id;if(g!=i){j=b.clone();a.append(j);if(l.IsTrust){j.addClass("item-parent-org")}j.prepend("<h3>"+l.ItemTypeName+"</h3>");j.children("h3").each(function(){if((!l.IsTrust)&&$(this).text()==$(this).parent().prev().children("h3").text()){$(this).remove("h3")}});jQuery("p > a",j).attr("href",l.ItemUrl).text(l.ItemName);d=j.children("dl")}d.append($("<dt>").text(l.RoleType));d.append($("<dd>").text(l.AccountName));d.append($("<dd>").append($("<a>").attr("href","mailto:"+l.Email).text(l.Email)));g=i})}$.fn.addOption=function(b,a){return this.append($("<option/>").val(b).text(a))};(function(a){a.fn.extend({pimsAutoComplete:function(b,d){var c=b.slice();a.each(c,function(f,e){c[f]=e.toUpperCase()});this.data("autocompletedata",c);this.autocompleteArray(b,d)}})})(jQuery);function removeVideo(c){var b=PimsAction.RemoveMediaFile;var a=getVideoUploadHandlerPath(c,b);performModuleActionInto(a,"videoContent",c,b)}var videoOnSuccess=function(b,a){if(b==PimsAction.Edit||b==PimsAction.CancelUpload||b==PimsAction.RemoveMediaFile||b==PimsAction.PreviewMediaFile){createAjaxVideoUpload(a)}};var videoOnBeforeSave=function(a){var b=true;if($("#deleteConfirmVideoRemoval"+a).length>0){return true}if($.trim($("#videotitle"+a).val())==""){$("#divErrorTitle"+a).removeClass("hidden");b=false}else{if($("#divErrorTitle"+a).length>0){$("#divErrorTitle"+a).addClass("hidden")}}if($.trim($("#videodesc"+a).val())==""){$("#divErrorDescription"+a).removeClass("hidden");b=false}else{if($("#divErrorDescription"+a).length>0){$("#divErrorDescription"+a).addClass("hidden")}}if($.trim($("#videocredits"+a).val())==""){$("#divErrorCredits"+a).removeClass("hidden");b=false}else{if($("#divErrorCredits"+a).length>0){$("#divErrorCredits"+a).addClass("hidden")}}if(b){alert("If you are uploading a new video, please note that it may take some time. During upload please do not perform any of the following;\n\n1. Click on any buttons on the page.\n2. Refresh the page.\n3. Close the browser window.\n\nThe page will refresh after the upload. Click OK to start.")}return b};function createAjaxVideoUpload(moduleGuid){var handler=getVideoUploadHandlerPath(moduleGuid,PimsAction.PreviewMediaFile);var module=$("#videoContent"+moduleGuid);var parentModule=$("#module"+moduleGuid);var savePanel=parentModule.find("div.panel-save");var au=new AjaxUpload("#changeVideoLink"+moduleGuid,{action:handler,autoSubmit:true,onChange:function(file,extension){},onSubmit:function(file,extension){eval("au"+moduleGuid+" = this;");if(!isVideoFile(extension)){$("#fileUploadErrorDiv"+moduleGuid).removeClass("hidden");return false}$("#fileUploadErrorDiv"+moduleGuid).addClass("hidden");if($("#videodesc"+moduleGuid).length){var arr=[];arr["videodesc"+moduleGuid]=$("#videodesc"+moduleGuid).val();this.setData(arr)}var html="<h3>Video loading</h3><br /> ";html+="<img src='/img/pims/admin/loading-animation.gif' class='image-uploading' /> ";html+="<p class='video-cancel'><a href='javascript:void(0);' onclick=\"cancelVideoUpload('"+moduleGuid+"')\" id='cancelVideoLink"+moduleGuid+"'>Cancel</a></p>";module.html(html);savePanel.fadeDisable()},onComplete:function(file,response){this.destroy();module.replaceWith(response);createAjaxVideoUpload(moduleGuid);savePanel.fadeEnable()}})}function cancelVideoUpload(moduleGuid){var au=eval("au"+moduleGuid);au.destroy();performModuleAction(moduleGuid,PimsAction.CancelUpload,0,0)}function isVideoFile(a){return(a=="mov"||a=="avi"||a=="wmv"||a=="mp4")}function getVideoUploadHandlerPath(a,b){return APP_ROOT+"/UserControls/SummaryAndPhoto/VideoUploadHandler.ashx?a="+b+"&m="+a+"&d="+(new Date().getTime().toString())}$(document).ready(function(){$(".showhide-wrap.transcript").each(function(){$(this).siblings(".media-prev").append('<p class="showhide-trig transcript-trig"><a href="#"><span>Show</span> transcript</a></p>');$(this).children(".showhide-content").children("h4:first").addClass("hidden")});$(".showhide-trig.transcript-trig").children("a").each(function(){$(this).click(function(){$(this).parent(".showhide-trig.transcript-trig").parent(".media-prev").siblings(".showhide-wrap.transcript").children(".showhide-content").toggle();$(this).toggleClass("active");$(this).children().text($(this).children().text()=="Hide"?"Show":"Hide");return false})})});var openingTimesOnSuccess=function(c){if(c===PimsAction.Edit||c===PimsAction.Save){$("table.public-holidays").find("input[type=checkbox]").each(function(){toggleTableRowInputs($(this))})}if(c===PimsAction.Save||c===PimsAction.Undo){b()}$("table.public-holidays tr").each(function(){UpdateDatePicker($(this))});function b(){if(!Pims||!Pims.ValidationDateTime){return}if(a()){Pims.ValidationDateTime.show()}else{Pims.ValidationDateTime.hide()}}function a(){var d=$(".pims-opening-times").find("td").filter(function(f,e){return e.innerText==="Unknown"});return d.length===0}};$(document).ready(function(){$(".addRow").live("click",addNewAdditionalDateRow);$(".deleteRow").live("click",function(){var a=$(".deleteRow").length-1;if(a>0){$(this).closest("tr").prev().remove();$(this).closest("tr").remove()}});$(".closed-all-day input:checkbox").live("click",function(){toggleTableRowInputs($(this))})});function clickEditOpeningTimes(){$(".name-openingtimesmodule .edit a")[0].click()}function addNewAdditionalDateRow(){var a=$("table.public-holidays tr:last");var g=a.prev();var e=false;g.find("input").each(function(){if($(this).val()!=""){e=true;return false}});if(e){var c=g.find("input[type=text]:eq(2)").attr("id").split("_");var b=parseInt(c[2],10)+1;g.clone(false).appendTo("table.public-holidays");a.clone().appendTo("table.public-holidays");var f=$("table.public-holidays tr:last");var d=$("table.public-holidays tr:last").prev();RemoveInputErrorClassFromInputs(d);UpdateInputIdIncludeRowId(d,b);UpdateInputLabelForAttributeToMatchInputId(d,b);UpdateCheckboxIdToIncludeRowId(f,b);UpdateCheckboxLabelForAttributeToMatchInputId(f,b);UpdateDatePicker(d);d.find("input:first").focus()}}function RemoveInputErrorClassFromInputs(a){a.find("input").each(function(){$(this).removeClass("input-error")})}function UpdateInputIdIncludeRowId(b,a){b.find("input[type=text]").val("").each(function(){$(this).removeAttr("disabled").removeClass("pubHolChecked");$(this).attr({id:function(d){var e=$(this).attr("id");var c=e.split("_");c[2]=a;$(this).attr("name",c.join("_"));return c.join("_")}})})}function UpdateInputLabelForAttributeToMatchInputId(b,a){b.find("label").each(function(){$(this).attr({"for":function(d){var e=$(this).attr("for");var c=e.split("_");c[2]=a;return c.join("_")}})})}function UpdateCheckboxIdToIncludeRowId(b,a){b.find("input[type=checkbox]").each(function(){$(this).attr("checked",false);$(this).attr({id:function(d){var e=$(this).attr("id");var c=e.split("_");c[1]=a;$(this).attr("name",c.join("_"));return c.join("_")}})})}function UpdateCheckboxLabelForAttributeToMatchInputId(b,a){b.find("label").each(function(){$(this).attr({"for":function(d){var e=$(this).attr("for");var c=e.split("_");c[1]=a;return c.join("_")}})})}function UpdateDatePicker(a){a.find("input.datePicker").attr("readonly",true).removeClass("hasDatepicker").datepicker({dateFormat:"dd/mm/yy",changeMonth:true,changeYear:true})}function toggleTableRowInputs(c){var d=c.parent().parent().parent().children().index(c.parent().parent());var a="table.public-holidays tr:nth-child("+d+")";var b=$(a);if(c.attr("checked")){b.find("input").not("input:first").each(function(){$(this).attr("disabled",true).addClass("pubHolChecked")})}else{b.find("*").not("input:first").each(function(){$(this).removeAttr("disabled").removeClass("pubHolChecked")})}}$(document).ready(function(){if((!$("body").hasClass("editmode"))&&(!$("body").hasClass("mobile"))){$(".tab-title, .tab-content").addClass("hidden");$(".tab-content").eq(0).removeClass("hidden");$(".tab-content, .last-verified, .additional-info").addClass("js");$(".tabbed-content-wrap").prepend('<ul class="tabs"></ul>');var a=[];$(".tab-title").each(function(){a.push($(this).text())});var b=0;for(i=0;i<a.length;i++){$(".tabbed-content-wrap").children("ul.tabs").append('<li class="tab-link"><a href="#" class="tab-'+b+++'">'+a[i]+"</a></li>")}var b=0;$(".tab-content").each(function(){$(this).attr("id","tab-"+b++)});$(".tabbed-content-wrap").children("ul.tabs").children("li").children("a").each(function(){$(this).click(function(){$(this).removeClass("ie-focus");$(this).parent("li").siblings("li").removeClass("active");$(this).parent("li").addClass("active");var c=$(this).attr("class");$(".tab-content").addClass("hidden");switch(c){case"tab-0":$('div[id*="tab-0"]').removeClass("hidden");break;case"tab-1":$('div[id*="tab-1"]').removeClass("hidden");break;case"tab-2":$('div[id*="tab-2"]').removeClass("hidden");break;case"tab-3":$('div[id*="tab-3"]').removeClass("hidden");break}return false})});if(a.length==1){$("li.tab-link").prepend('<span class="crnr tab-tl"></span><span class="crnr tab-tr"></span>').addClass("active")}else{$("li.tab-link:first").prepend('<span class="crnr tab-tl"></span>').addClass("active");$("li.tab-link:last").prepend('<span class="crnr tab-tr"></span>')}$(".tab-title").remove()}});(function(h){var k,j,g=[],i=window;h.fn.tinymce=function(c){var s=this,t,d,a,f,b,e="",q="";if(!s.length){return s}if(!c){return tinyMCE.get(s[0].id)}function r(){var m=[],n=0;if(l){l();l=null}s.each(function(p,x){var o,z=x.id,y=c.oninit;if(!z){x.id=z=tinymce.DOM.uniqueId()}o=new tinymce.Editor(z,c);m.push(o);if(y){o.onInit.add(function(){var v,u=y;if(++n==m.length){if(tinymce.is(u,"string")){v=(u.indexOf(".")===-1)?null:tinymce.resolve(u.replace(/\.\w+$/,""));u=tinymce.resolve(u)}u.apply(v||tinymce,m)}})}});h.each(m,function(p,o){o.render()})}if(!i.tinymce&&!j&&(t=c.script_url)){j=1;a=t.substring(0,t.lastIndexOf("/"));if(/_(src|dev)\.js/g.test(t)){q="_src"}f=t.lastIndexOf("?");if(f!=-1){e=t.substring(f+1)}i.tinyMCEPreInit=i.tinyMCEPreInit||{base:a,suffix:q,query:e};if(t.indexOf("gzip")!=-1){b=c.language||"en";t=t+(/\?/.test(t)?"&":"?")+"js=true&core=true&suffix="+escape(q)+"&themes="+escape(c.theme)+"&plugins="+escape(c.plugins)+"&languages="+b;if(!i.tinyMCE_GZ){tinyMCE_GZ={start:function(){tinymce.suffix=q;function m(n){tinymce.ScriptLoader.markDone(tinyMCE.baseURI.toAbsolute(n))}m("langs/"+b+".js");m("themes/"+c.theme+"/editor_template"+q+".js");m("themes/"+c.theme+"/langs/"+b+".js");h.each(c.plugins.split(","),function(o,n){if(n){m("plugins/"+n+"/editor_plugin"+q+".js");m("plugins/"+n+"/langs/"+b+".js")}})},end:function(){}}}}h.ajax({type:"GET",url:t,dataType:"script",cache:true,success:function(){tinymce.dom.Event.domLoaded=1;j=2;if(c.script_loaded){c.script_loaded()}r();h.each(g,function(n,m){m()})}})}else{if(j===1){g.push(r)}else{r()}}return s};h.extend(h.expr[":"],{tinymce:function(a){return a.id&&!!tinyMCE.get(a.id)}});function l(){function b(f){if(f==="remove"){this.each(function(r,p){var q=a(p);if(q){q.remove()}})}this.find("span.mceEditor,div.mceEditor").each(function(r,p){var q=tinyMCE.get(p.id.replace(/_parent$/,""));if(q){q.remove()}})}function d(p){var o=this,f;if(p!==k){b.call(o);o.each(function(r,m){var n;if(n=tinyMCE.get(m.id)){n.setContent(p)}})}else{if(o.length>0){if(f=tinyMCE.get(o[0].id)){return f.getContent()}}}}function a(n){var f=null;(n)&&(n.id)&&(i.tinymce)&&(f=tinyMCE.get(n.id));return f}function e(f){return !!((f)&&(f.length)&&(i.tinymce)&&(f.is(":tinymce")))}var c={};h.each(["text","html","val"],function(r,p){var f=c[p]=h.fn[p],q=(p==="text");h.fn[p]=function(o){var t=this;if(!e(t)){return f.apply(t,arguments)}if(o!==k){d.call(t.filter(":tinymce"),o);f.apply(t.not(":tinymce"),arguments);return t}else{var n="";var m=arguments;(q?t:t.eq(0)).each(function(w,x){var s=a(x);n+=s?(q?s.getContent().replace(/<(?:"[^"]*"|'[^']*'|[^'">])*>/g,""):s.getContent()):f.apply(h(x),m)});return n}}});h.each(["append","prepend"],function(r,q){var f=c[q]=h.fn[q],p=(q==="prepend");h.fn[q]=function(n){var m=this;if(!e(m)){return f.apply(m,arguments)}if(n!==k){m.filter(":tinymce").each(function(u,v){var o=a(v);o&&o.setContent(p?n+o.getContent():o.getContent()+n)});f.apply(m.not(":tinymce"),arguments);return m}}});h.each(["remove","replaceWith","replaceAll","empty"],function(o,f){var p=c[f]=h.fn[f];h.fn[f]=function(){b.call(this,f);return p.apply(this,arguments)}});c.attr=h.fn.attr;h.fn.attr=function(s,v,t){var r=this;if((!s)||(s!=="value")||(!e(r))){return c.attr.call(r,s,v,t)}if(v!==k){d.call(r.filter(":tinymce"),v);c.attr.call(r.not(":tinymce"),s,v,t);return r}else{var u=r[0],f=a(u);return f?f.getContent():c.attr.call(h(u),s,v,t)}}}})(jQuery);function validateMCE(showError){var editor=tinyMCE.activeEditor;var textarea=$("#"+editor.editorId);var htmltext=editor.getContent();var plaintext=htmltext.length>0?$(editor.getContent()).text():"";var minimumLength=parseInt(textarea.attr("minimumLength"));var maximumLength=parseInt(textarea.attr("maximumLength"));var isRequired=eval(textarea.attr("isRequired"));var textLength=plaintext.length;var errorbarId="#errorBar_"+editor.id;var statusbarId="#statusBar_"+editor.id;var errorBar=$(errorbarId);var statusBar=$(statusbarId);if(minimumLength!=NaN&&textLength<minimumLength&&!(!isRequired&&textLength==0)){errorBar.html("<p>Please enter at least "+minimumLength.toString()+" characters</p>");if(showError){errorBar.removeClass("hidden")}statusBar.html("<p><strong>"+(maximumLength-textLength).toString()+"</strong> characters remaining</p>");return false}else{if(maximumLength!=NaN&&maximumLength!=0&&textLength>maximumLength){errorBar.html("<p>Please enter no more than "+maximumLength.toString()+" characters</p>");if(showError){errorBar.removeClass("hidden")}statusBar.html("<p><strong>"+(textLength-maximumLength).toString()+"</strong> characters too many</p>");return false}else{if(maximumLength>0){errorBar.addClass("hidden");statusBar.html("<p><strong>"+(maximumLength-textLength).toString()+"</strong> characters remaining</p>");return true}}}return true};(function(a){a.fn.extend({autocompleteArray:function(c,b){b=a.extend({},a.AutocompleterArray.defaults,{data:c,delay:10},b);b.highlight=b.highlight||function(d){return d};b.formatMatch=b.formatMatch||b.formatResult;return this.each(function(){new a.AutocompleterArray(this,b)})},result:function(b){return this.bind("result",b)},search:function(b){return this.trigger("search",[b])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(b){return this.trigger("setOptions",[b])},unautocompleteArray:function(){return this.trigger("unautocompleteArray")}});a.AutocompleterArray=function(t,j){var o={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var i=a(t).attr("autocompleteArray","off").addClass(j.inputClass);var y;var n=i.val();var u="";var l=a.AutocompleterArray.Cache(j);var B=0;var h;var w={mouseDownOnSelect:false};var r=a.AutocompleterArray.Select(j,t,x,w);var f;a(t.form).bind("submit.autocompleteArray",function(){if(f){f=false;return false}});a("#"+i.attr("id")).live((a.browser.opera?"keypress":"keydown")+".autocompleteArray",function(C){h=C.keyCode;switch(C.keyCode){case o.UP:C.preventDefault();if(r.visible()){r.prev()}else{k(0,true)}break;case o.DOWN:C.preventDefault();if(r.visible()){r.next()}else{k(0,true)}break;case o.TAB:if(r.visible()){r.next();C.preventDefault()}break;case o.PAGEUP:C.preventDefault();if(r.visible()){r.pageUp()}else{k(0,true)}break;case o.PAGEDOWN:C.preventDefault();if(r.visible()){r.pageDown()}else{k(0,true)}break;case j.multiple&&a.trim(j.multipleSeparator)==","&&o.COMMA:case o.RETURN:if(x()){C.preventDefault();f=true;return false}break;case o.ESC:r.hide();break;default:clearTimeout(y);y=setTimeout(k,j.delay);break}}).focus(function(){B++}).blur(function(){B=0;if(!w.mouseDownOnSelect){A();m()}}).click(function(){if(B++>1&&!r.visible()){k(0,true)}}).bind("search",function(){B++;k(0,true,true);b(i.val())}).bind("flushCache",function(){l.flush()}).bind("setOptions",function(){a.extend(j,arguments[1]);if("data" in arguments[1]){l.populate()}}).bind("unautocompleteArray",function(){r.unbind();i.unbind();a(t.form).unbind(".autocompleteArray")});function x(){var G=r.selected();if(!G){return false}var J=G.result;u=J;if(j.multiple){var O=p(i.val());if(O.length>1){J=O.slice(0,O.length-1).join(j.multipleSeparator)+j.multipleSeparator+J}J+=j.multipleSeparator}i.val(J);c();i.trigger("result",[G.data,G.value]);var P="input#hiddenServiceDeliverers";if(a(P).length&&a(P).val()!=""&&a(P).val()!=null){var R=J;var M=/provided-by-trust/g;var E=/provided-by-third-party/g;a(".service-locations").find("input").each(function(){a(this).removeAttr("checked").removeAttr("disabled");a(this).parent("label").css("cursor","pointer");a(this).removeClass("existing-location")});function L(){a("input#third-party-organisation-name").val("Enter name of organisation");a("input#third-party-organisation-url").val("Enter organisation URL (optional)");a("input#third-party-organisation-name, input#third-party-organisation-url").removeAttr("disabled").css({background:"#ffffff",borderWidth:"1px"})}L();function H(V){var V=V;V=V.replace("provided-by-third-party(","");V=V.replace(")","");var U=V.split("|");var T=U[0];var W=U[1];a("input#third-party-organisation-name").val(T);a("input#third-party-organisation-url").val(W);a("input#third-party-organisation-name, input#third-party-organisation-url").attr("disabled","disabled").css({background:"#dadada",borderWidth:"1px"})}function F(T){var U=a(T);U.attr("checked","checked");U.attr("disabled","disabled");U.parent("label").css("cursor","default");U.addClass("existing-location")}var N=a("input#hiddenServiceDeliverers").val();if(N.indexOf(";")>-1){var Q=N.split(";")}else{var Q=[N]}for(var K=0;K<Q.length;K++){if(Q[K]!=""&&Q[K]!=null){var D=Q[K].split(":");var S=D[0];var I=D[1];if(I.indexOf(",")>-1){var C=I.split(",")}else{var C=[I]}if(R==S){a(".service-locations").addClass("existing-locations-true");a(".service-locations").find("input[type=checkbox]").each(function(){var U=a(this).attr("name");for(var T=0;T<C.length;T++){if(U==C[T]){F(this);L()}var W=M.test(C[T]);if(W==true){a("input#provided-by-trust").each(function(){F(this)});L()}var V=E.test(C[T]);if(V==true){for(var T=0;T<C.length;T++){a("input#provided-by-third-party").each(function(){F(this);H(C[T])})}}}})}}}}return true}function A(){var C=r.getSelectedValue();if(C===1||i.val()===""||i.val()===n){return false}a('input[id$="'+j.hiddenTreatmentID+'"]').val("-1");c()}function b(C){var E=a("<label/>").attr("id","for-lblTreatment").attr("for","lblTreatment");E.html(C+"   ");var D=a("<a/>").attr("id","treatment-name").attr("href","");D.html("change");E.append(D);i.after(E);i.hide();D.click(function(F){F.preventDefault();a("label[id='for-lblTreatment']").remove();i.val(n);i.show()})}function k(E,F,D){if(h==o.DEL){r.hide();return}var C=i.val();if(!F&&C==u){return}u=C;C=z(C);if(C.length>=j.minChars){i.addClass(j.loadingClass);if(!j.matchCase){C=C.toLowerCase()}s(C,q,c)}else{g();r.hide()}}function p(C){if(!C){return[""]}var D=C.split(j.multipleSeparator);var E=[];a.each(D,function(F,G){if(a.trim(G)){E[F]=a.trim(G)}});return E}function z(D){if(!j.multiple){return D}var C=p(D);return C[C.length-1]}function v(D,C){if(j.autoFill&&(z(i.val()).toLowerCase()==D.toLowerCase())&&h!=o.BACKSPACE){i.val(i.val()+C.substring(z(u).length));a.AutocompleterArray.Selection(t,u.length,u.length+C.length)}}function m(){c()}function c(){var C=r.visible();r.hide();clearTimeout(y);g();if(j.mustMatch){i.search(function(D){if(!D){if(j.multiple){var E=p(i.val()).slice(0,-1);i.val(E.join(j.multipleSeparator)+(E.length?j.multipleSeparator:""))}else{i.val("")}}})}if(C){a.AutocompleterArray.Selection(t,t.value.length,t.value.length)}}function q(D,C){if(C&&C.length&&B){g();r.display(C,D);v(D,C[0].value);r.show()}else{c()}}function e(D,C){if(C&&C.length&&B){g()}else{c()}}function s(E,F,C){if(!j.matchCase){E=E.toLowerCase()}var D=l.load(E);if(D&&D.length){F(E,D)}else{r.emptyList();C(E)}}function d(D){var F=[];var G=D.split("\n");for(var E=0;E<G.length;E++){var C=a.trim(G[E]);if(C){C=C.split("|");F[F.length]={data:C,value:C[0],result:j.formatResult&&j.formatResult(C,C[0])||C[0]}}}return F}function g(){i.removeClass(j.loadingClass)}};a.AutocompleterArray.defaults={inputClass:"treatment",resultsClass:"predictive",loadingClass:"ac_loading",minChars:2,delay:400,matchCase:false,matchSubset:true,matchContains:true,cacheLength:10,max:5,mustMatch:false,extraParams:{},selectFirst:false,formatItem:function(b,c,d){return"<a id='treatment-"+c+"' tabIndex='"+c+"'>"+b[0]+"</a>"},formatMatch:function(b,c,d){return b[0]},formatResult:function(b,c,d){return b[0]},autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:false,scrollHeight:180};a.AutocompleterArray.Cache=function(d){var b={};var g=0;function e(k,l){if(!d.matchCase){k=k.toLowerCase()}var j=k.indexOf(l);if(j==-1){return false}return j==0||d.matchContains}function c(j,i){if(g>d.cacheLength){h()}if(!b[j]){g++}b[j]=i}function f(){if(!d.data){return false}var o={},p=0;d.cacheLength=1;o[""]=[];for(var k=0,n=d.data.length;k<n;k++){var l=d.data[k];l=(typeof l=="string")?[l]:l;var j=d.formatMatch(l,k+1,d.data.length);if(j===false){continue}var m=j.charAt(0).toLowerCase();if(!o[m]){o[m]=[]}var q={value:j,data:l,result:d.formatResult&&d.formatResult(l)||j};o[m].push(q);if(p++<d.max){o[""].push(q)}}a.each(o,function(r,s){d.cacheLength++;c(r,s)})}f();function h(){b={};g=0}return{flush:h,add:c,populate:f,load:function(j){if(!d.cacheLength||!g){return null}if(d.matchContains){var o=[];for(var m in b){if(m.length>0){var n=b[m];a.each(n,function(k,p){if(e(p.value,j)){o.push(p)}})}}return o}else{if(b[j]){return b[j]}else{if(d.matchSubset){for(var l=j.length-1;l>=d.minChars;l--){var n=b[j.substr(0,l)];if(n){var o=[];a.each(n,function(k,p){if(e(p.value,j)){o[o.length]=p}});return o}}}}}return null}}};a.AutocompleterArray.Select=function(q,r,p,k){var d={ACTIVE:"ac_over"};var h,j=-1,n,f="",l=true,e,u=-1,b;function i(){if(l==true){e=a("<div id='predictive'/>").append("<div class='pad border'/>").hide().addClass(q.resultsClass).appendTo(a(r).parent());b=a("<ul id='predictive-list'/>").appendTo(e.children(".pad")).mouseover(function(v){if(s(v).nodeName&&s(v).nodeName.toUpperCase()=="LI"){j=a("li",b).removeClass(d.ACTIVE).index(s(v));a(s(v)).addClass(d.ACTIVE)}}).click(function(v){a(s(v)).addClass(d.ACTIVE);p();if(r.visible){r.focus()}return false}).mousedown(function(){k.mouseDownOnSelect=true}).mouseup(function(){k.mouseDownOnSelect=false});e.children("div:eq(0)").find("a").mousedown(function(){k.mouseDownOnSelect=true});l=false;if(a.fn.bgiframe){e.bgiframe()}}}function s(w){var v=w.target;while(v&&v.tagName!="LI"){v=v.parentNode}if(!v){return[]}return v}function c(w){h.slice(j,j+1).removeClass(d.ACTIVE);g(w);var v=h.slice(j,j+1).addClass(d.ACTIVE);if(q.scroll){var x=0;h.slice(0,j).each(function(){x+=this.offsetHeight});if((x+v[0].offsetHeight-b.scrollTop())>b[0].clientHeight){b.scrollTop(x+v[0].offsetHeight-b.innerHeight())}else{if(x<b.scrollTop()){b.scrollTop(x)}}}}function g(v){j+=v;if(j<0){j=h.size()-1}else{if(j>=h.size()){j=0}}}function o(v){return q.max&&q.max<v?q.max:v}function t(){alert("show no results")}function m(){if(a("#predictive-error").length>0){a("#predictive-error").remove()}if(!b.visible){b.show()}b.empty();var y=o(n.length);for(var v=0;v<y;v++){if(!n[v]){continue}var w=q.formatItem(n[v].data,v+1,y,n[v].value,f);if(w===false){continue}var x=a("<li/>").html(q.highlight(w,f)).addClass(v%2==0?"ac_even":"ac_odd").appendTo(b)[0];a.data(x,"ac_data",n[v])}h=b.find("li");if(q.selectFirst){h.slice(0,1).addClass(d.ACTIVE);j=0}if(a.fn.bgiframe){b.bgiframe()}}return{display:function(v,w){if(a(r).val().length==2&&a("#predictive").length==0){i()}n=v;f=w;m()},next:function(){c(1)},prev:function(){c(-1)},pageUp:function(){if(j!=0&&j-8<0){c(-j)}else{c(-8)}},pageDown:function(){if(j!=h.size()-1&&j+8>h.size()){c(h.size()-1-j)}else{c(8)}},hide:function(){e&&e.hide();h&&h.removeClass(d.ACTIVE);j=-1},showError:function(){jDivError=a("<div id='predictive-error' class='error'/>").append("<p>We are sorry, the letters you have entered do not match any of the conditions or treatments in our list.</p>");jDivError.append("<p>Please check your spelling</p>").append("<p>or</p>");b&&b.hide();if(e!=null){e.find("div > *:eq(0)").after(jDivError)}u=-1},visible:function(){return e&&e.is(":visible")},current:function(){return this.visible()&&(listItmes.filter("."+d.ACTIVE)[0]||q.selectFirst&&h[0])},show:function(){var x=a(r).offset();e.show();if(q.scroll){b.scrollTop(0);b.css({maxHeight:q.scrollHeight,overflow:"auto"});if(a.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var v=0;h.each(function(){v+=this.offsetHeight});var w=v>q.scrollHeight;if(!w){h.width(b.width()-parseInt(h.css("padding-left"))-parseInt(h.css("padding-right")))}}}},selected:function(){var v=h&&h.filter("."+d.ACTIVE).removeClass(d.ACTIVE);if(v){u=1}else{u=-1}return v&&v.length&&a.data(v[0],"ac_data")},getSelectedValue:function(){return u},emptyList:function(){b&&b.empty()},unbind:function(){e&&e.remove()}}};a.AutocompleterArray.Selection=function(d,e,b){if(d.createTextRange){var c=d.createTextRange();c.collapse(true);c.moveStart("character",e);c.moveEnd("character",b);c.select()}else{if(d.setSelectionRange){d.setSelectionRange(e,b)}else{if(d.selectionStart){d.selectionStart=e;d.selectionEnd=b}}}d.focus()}})(jQuery);(function($){$.toJSON=function(o){if(typeof(JSON)=="object"&&JSON.stringify){return JSON.stringify(o)}var type=typeof(o);if(o===null){return"null"}if(type=="undefined"){return undefined}if(type=="number"||type=="boolean"){return o+""}if(type=="string"){return $.quoteString(o)}if(type=="object"){if(typeof o.toJSON=="function"){return $.toJSON(o.toJSON())}if(o.constructor===Date){var month=o.getUTCMonth()+1;if(month<10){month="0"+month}var day=o.getUTCDate();if(day<10){day="0"+day}var year=o.getUTCFullYear();var hours=o.getUTCHours();if(hours<10){hours="0"+hours}var minutes=o.getUTCMinutes();if(minutes<10){minutes="0"+minutes}var seconds=o.getUTCSeconds();if(seconds<10){seconds="0"+seconds}var milli=o.getUTCMilliseconds();if(milli<100){milli="0"+milli}if(milli<10){milli="0"+milli}return'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(o.constructor===Array){var ret=[];for(var i=0;i<o.length;i++){ret.push($.toJSON(o[i])||"null")}return"["+ret.join(",")+"]"}var pairs=[];for(var k in o){var name;var type=typeof k;if(type=="number"){name='"'+k+'"'}else{if(type=="string"){name=$.quoteString(k)}else{continue}}if(typeof o[k]=="function"){continue}var val=$.toJSON(o[k]);pairs.push(name+":"+val)}return"{"+pairs.join(", ")+"}"}};$.evalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}return eval("("+src+")")};$.secureEvalJSON=function(src){if(typeof(JSON)=="object"&&JSON.parse){return JSON.parse(src)}var filtered=src;filtered=filtered.replace(/\\["\\\/bfnrtu]/g,"@");filtered=filtered.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");filtered=filtered.replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered)){return eval("("+src+")")}else{throw new SyntaxError("Error parsing JSON, source is not valid.")}};$.quoteString=function(string){if(string.match(_escapeable)){return'"'+string.replace(_escapeable,function(a){var c=_meta[a];if(typeof c==="string"){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+string+'"'};var _escapeable=/["\\\x00-\x1f\x7f-\x9f]/g;var _meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"}})(jQuery);function removeFile(c){var b=PimsAction.RemoveMediaFile;var a=getFileUploadHandlerPath(c,b);performModuleActionInto(a,"assoc-docs",c,b)}var fileUploadOnSuccess=function(b,a){if(b==PimsAction.Edit||b==PimsAction.RemoveMediaFile||b==PimsAction.SaveInSession){createAjaxFileUpload(a)}};function createAjaxFileUpload(moduleGuid){var handler=getFileUploadHandlerPath(moduleGuid,PimsAction.SaveInSession);var module=$("#assoc-docs"+moduleGuid);var parentModule=$("#assoc-docs"+moduleGuid);var savePanel=parentModule.find("div.panel-save");var fu=new AjaxUpload("#ChangeAssocDoc"+moduleGuid,{action:handler,autoSubmit:true,onChange:function(file,extension){eval("fu"+moduleGuid+" = this;");$("a.current-file").text(file)},onSubmit:function(file,extension){eval("fu"+moduleGuid+" = this;");if(!isValidFile(extension,moduleGuid)){$("#genericFileUploadErrorDiv"+moduleGuid).removeClass("hidden");return false}var arr=[];$("#genericFileUploadErrorDiv"+moduleGuid).addClass("hidden");if($("#TitleAssocDoc"+moduleGuid).length){arr["TitleAssocDoc"+moduleGuid]=$("#TitleAssocDoc"+moduleGuid).val()}arr["FileNameAssocDoc"+moduleGuid]=file;this.setData(arr);var html="<h3>uploading file</h3><br /> ";html+="<img src='/img/pims/admin/loading-animation.gif' class='image-uploading' /> ";module.html(html);savePanel.fadeDisable();$("#RemoveAssocDoc"+moduleGuid).fadeEnable()},onComplete:function(file,response){this.destroy();parentModule.replaceWith(response);createAjaxFileUpload(moduleGuid);savePanel.fadeEnable()}})}function isValidFile(ext,moduleGuid){var acceptableFileExtsStr=eval("fileExts"+moduleGuid);var exts=acceptableFileExtsStr.split(",");for(index=0;index<exts.length;index++){if(ext[0]==$.trim(exts[index])){return true}}return false}function getFileUploadHandlerPath(a,b){return APP_ROOT+"/UserControls/FileUpload/FileUploadHandler.ashx?a="+b+"&m="+a+"&id="+getOrganisationId()+"&d="+(new Date().getTime().toString())}function getOrganisationId(){var a=RegExp("[?&]id=([^&]*)").exec(window.location.search);return a&&decodeURIComponent(a[1].replace(/\+/g," "))};var listItemOnSuccess=function(a,b){fileUploadOnSuccess(a,b);if(a==PimsAction.Delete){var c=$("#module"+b);$(".panel-bar",c).hide();$(".panel-content",c).hide();c.addClass("deleted-member")}};$(document).ready(function(){$("a#addLink").live("click",addNewClonedRow);$("a#removeLink").live("click",removeRow)});function removeRow(){$(this).parent().parent().parent().parent().remove();return false}function addNewClonedRow(){var a=$("div.other-location-row:last");var b="";if(a==null||a.find(".newrow").length==0){b="new0"}else{var e=a.find(".newrow").val().substring(3);b="new"+(parseInt(e,10)+1)}var d=$("div#rowTemplate > div").clone(false);d.addClass("other-location-row");d.html(d.html().replace(/REPLACEME/gi,b).replace(/^\s+|\s+$/g,""));d.find(":input").attr({name:function(){return $(this).attr("id")}});d.html(d.html().replace(/dummy/gi,"class"));$(this).parent().before(d);var c=$("#mceTemplate > div").clone(false).html().replace(/REPLACEME/gi,b).replace(/dummy/gi,"class").replace(/^\s+|\s+$/g,"");d.find(".mceholder").html(c);configureTinyMCE("richTextBox_"+b);$("a#removeLink").live("click",removeRow);return false};$(document).ready(function(){$("#ddAliases").change(function(b){var a=$("#ddAliases option").index($("#ddAliases option").filter(":selected"));$(".hfselectedindex > :hidden").val(a)})});$(document).ready(function(){$("ul.staff-list > li > span > a").live("click",removeStaff);$("p.staff-list-add > a").live("click",addStaff)});function removeStaff(e){var g=$(this).closest("li");var b=g.children("input[type=hidden]").val();var f=g.children("a").text();var d=g.clone().children().remove().end().text().replace(/^\s+|\s+$/g,"");$(this).closest("li").remove();$("div.serv-staff-providers select").append('<option value="'+b+'">'+f+" - "+d+"</option>");var a=$("input[type=hidden]#removeList");var c=$("input[type=hidden]#addList");AddToHiddenIdList(c,a,b);return false}function addStaff(h){var d=$("div.serv-staff-providers select option:selected");var f=d.val();if(f==0){return false}var j=d.text();var g=j.split("-");var i=g[0].replace(/^\s+|\s+$/g,"");var a=g[1].replace(/^\s+|\s+$/g,"");var c='<li><a href="#">'+i+"</a><br />"+a+'<span><a href="#">Remove</a></span><input type="hidden" value="'+f+'" /></li>';$("ul.staff-list").append(c);$("option:selected","div.serv-staff-providers select").remove();var e=$("input[type=hidden]#removeList");var b=$("input[type=hidden]#addList");AddToHiddenIdList(e,b,f);return false}function AddToHiddenIdList(d,a,e){var f=d.val().split(";");var c="";var b=false;for(var g=0;g<f.length;g++){if(f[g]!=e){if(f[g]!=""){c=c+f[g]+";"}}else{b=true}}d.val(c.substr(0,c.length-1));if(b){return false}a.val(a.val()+";"+e)};function setup_tag_autocomplete(a,b){$(a).pimsAutoComplete(b,{max:10,minChars:2})};function UpdateCharCount(f,d){var b=$("#"+f);var c=$("#"+d);if(b.data("error")!=null&&b.data("error")==true){return false}var g=b.val();if(g==b.data("prompttext")){g=""}var e=b.data("maxlength");if(g.length>e){b.data("error",true);g=g.substr(0,e);alert("You have reached the maximum number of characters allowed. Your text will be truncated to "+e+" characters.");b.val(g);b.data("error",false)}var a=e-g.length;c.text(a+" of "+e+" remaining")}function SetupCharCountAndPromptText(g,f,e,b){var c=$("#"+g);var d=c.get(0).tagName;if((f<=0)||(d!="INPUT"&&d!="TEXTAREA")||(d=="INPUT"&&c.attr("type")!="text")){return false}var h=ReplaceTextPlaceholders(b);var a=c[0].value;c[0].defaultValue=h;if(a==h||a==""){c[0].value=h}else{c[0].value=a}c.data("maxlength",f);c.data("prompttext",h);if(d=="INPUT"){c.attr("maxlength",f)}c.keyup(function(){UpdateCharCount(g,e)});return true}function ReplaceTextPlaceholders(a){a=a.replace(/@@/g,"\r\n");a=a.replace(/@-/g,"\t* ");return a}function SetupScreenName(b,a,c,d){$("input#"+a).data("value",c);$("input#"+b).click(function(){var e=$("input#"+a);if(this.checked){e.data("value",e.val());e.val("Anonymous");e.attr("readonly","readonly")}else{var f=e.data("value");e.val(f);e.attr("readonly",(d)?"readonly":"")}})}function SetupStarRatings(a,c,b){var d=0;$(a).each(function(){var f=b+d;var e=$('<span id="'+f+'" class="caption"></span>');$(this).stars({inputType:"select",captionEl:e,cancelShow:false,removeCaption:false,displayDefaultText:c,disableValue:false});$(e).appendTo($(this));d++})}jQuery(document).ready(function(){if($(".pims .share").length){$(".share").addClass("share-js");$(".share span.colon").addClass("hidden");$(".share .share-text").wrap('<a href="#share" class="share-link" />');$(".share .share-list-items").prepend('<p>Share this review <a href="#close" class="share-close" title ="Close this share box">Close</a></p>');$(".share .share-list").css("opacity","0").addClass("hidden");$(".share-list-items").find("a").attr("tabindex","-1");$(".share-link, .share-close").each(function(){$(this).click(function(){if($(this).parents(".share").find(".share-list").css("opacity")=="0"){$(this).parents(".share").find(".share-list").removeClass("hidden");$(this).parents(".share").find(".share-list").find(".share-list-items").find("a").removeAttr("tabindex");$(this).parents(".share").find(".share-list").addClass("share-ie67-show");$(this).parents(".share").find(".share-list").fadeTo("fast",1)}else{$(this).parents(".share").find(".share-list").addClass("hidden");$(this).parents(".share").find(".share-list").removeClass("share-ie67-show");$(this).parents(".share").find(".share-list").fadeTo("fast",0)}return false})});$(".share-close").each(function(){$(this).click(function(){$(this).parents(".share-list-items").find("a").each(function(){$(this).attr("tabindex","-1")});$(this).parents(".share-list-items").parents(".share").find(".share-link").focus()})});$(".share .share-list a").each(function(){$(this).focus(function(){if($(this).parents(".share").find(".share-list").css("opacity")=="0"){$(this).parents(".share").find(".share-list").removeClass("hidden").css("opacity","1")}}).blur(function(){if($(this).is(":last-child")||$(this).is(":first-child")){$(this).parents(".share").find(".share-list").addClass("hidden").css("opacity","0")}})})}});$(document).ready(function(){$(".lb-trig").each(function(){dialogClass="";if($(this).hasClass("lb-scorecard")){dialogClass="lb-graph"}$(this).click(function(){var a=$(this).attr("href");$.get(a,function(c){var d=$(c).find(".wrapper").html();var b=$('<div class="lb-overlay">'+d+"</div>").dialog({autoOpen:false,draggable:false,closeOnEscape:true,dialogClass:dialogClass,modal:true,width:720,closeText:"Close",position:"top",close:function(f,e){b.html("");b.dialog("destroy")}});b.dialog("open");$(".ui-widget-overlay").css("opacity","0.5")});return false})})});$(function(){$("#aspnetForm").keypress(function(a){$("#errorMsg").empty();if(($("#txtAddProvider").val.length>0)&&(a.which&&a.which==13)||(a.keyCode&&a.keyCode==13)){$("#btnAdd").click();return false}else{return true}})});function performAdd(a,c){if(isValidProvider(c)){var b=$("#"+a);var e={provider:$.trim($("#"+c).val()),a:"add"};var d=function(f){$("body").css("cursor","auto");if(f.indexOf("<h1>Access Denied</h1>")>-1){loadAccessDeniedPage(f)}else{updateList(b,f);$("#"+c).val($("label[for='"+c+"']").text())}};doAjaxCall(e,d)}else{$("#errorMsg").html("<div class='error'><p>* Invalid provider</p></div>")}}function performDelete(a,d){var b=$("#"+a);var e={provider:d,a:"delete"};var c=function(f){$("body").css("cursor","auto");if(f.indexOf("<h1>Access Denied</h1>")>-1){loadAccessDeniedPage(f)}else{updateList(b,f)}};doAjaxCall(e,c)}function loadAccessDeniedPage(a){$("html").empty();$("html").append(a)}function doAjaxCall(a,b){$("body").css("cursor","wait");$.ajax({type:"POST",url:APP_ROOT+"/UserControls/MailProviderBlacklistHandler.ashx",data:a,cache:false,success:b,error:function(c,e,d){handleAjaxError(c)}})}function handleAjaxError(a){$("body").css("cursor","auto");$("#errorMsg").html("<div class='handler-error'><p>"+a.responseText+"</p></div>")}function isValidProvider(a){var b=$("label[for='"+a+"']").text();var c=$.trim($("#"+a).val());if(c.length==0||c==b){return false}return((c.indexOf(" ")==-1)&&(c.indexOf(".")>0))}function updateList(b,a){b.empty();$.each(a,function(c,h){var f=$("<a onclick=performDelete('list','"+h+"')/>").text("delete");var g=$("<li />").text(h);var d=g.append(f);d.appendTo(b)})};var Pims;(Pims=Pims||{}).ValidationDateTime=(function(){var a=function(){if(Pims&&Pims.refreshDisplayedPageLastUpdated){Pims.refreshDisplayedPageLastUpdated()}if(Pims&&Pims.refreshDisplayedOpeningTimesLastVerified){Pims.refreshDisplayedOpeningTimesLastVerified()}};return{onSuccess:function(b){if(b===PimsAction.Save){a()}},show:function(){$(".validation-date-time").removeClass("validation-hidden")},hide:function(){$(".validation-date-time").addClass("validation-hidden")}}})();